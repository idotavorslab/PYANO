"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const fs = require("fs");
const util = require("../util");
const pathx = require("../pathx");
class FileNew {
    constructor(absPathWithExt) {
        if (!util.bool(path.extname(absPathWithExt))) {
            console.error(`FileNew constructor: passed 'absPathWithExt' is extensionless: ${absPathWithExt}. Returning`);
        }
        if (!path.isAbsolute(absPathWithExt)) {
            console.error(`FileNew constructor: passed 'absPathWithExt' NOT absolute: ${absPathWithExt}. Returning`);
        }
        this._absPath = absPathWithExt;
    }
    get absPath() {
        return this._absPath;
    }
    set absPath(absPathWithExt) {
        if (!util.bool(path.extname(absPathWithExt))) {
            console.error(`FileNew set absPath: passed extensionless 'absPathWithExt': ${absPathWithExt}. Not setting`);
            return;
        }
        if (!path.isAbsolute(absPathWithExt)) {
            console.error(`FileNew set absPath: passed non-absolute 'absPathWithExt': ${absPathWithExt}. Not setting`);
            return;
        }
        this._absPath = absPathWithExt;
        fs.renameSync(this._absPath, absPathWithExt);
    }
    renameByOtherFile(other) {
        console.warn('called renameByOtherFile(), use set absPath instead');
        this.absPath = other.absPath;
    }
    renameByCTime() {
        const stats = fs.lstatSync(this.absPath);
        const datestr = stats.ctime.human();
        const newPath = pathx.push_before_ext(this.absPath, `__CREATED_${datestr}`);
        console.log('renameByCTime() to: ', newPath);
        this.absPath = newPath;
    }
    async getBitrateAndHeight() {
        if (!this._absPath.endsWith('mp4') && !this._absPath.endsWith('mov')) {
            console.warn(`FileNew: "${this._absPath}" isn't "mp4" or "mov"`);
            return undefined;
        }
        const { execSync } = require('child_process');
        const ffprobeCmd = `ffprobe -v quiet -print_format json -show_streams -show_format`;
        const probe = JSON.parse(execSync(`${ffprobeCmd} "${this._absPath}"`, { encoding: 'utf8' }));
        const { bit_rate, height } = probe.streams.find(s => s["codec_type"] === "video");
        return [bit_rate, height];
    }
    exists() {
        return fs.existsSync(this._absPath);
    }
    remove() {
        fs.unlinkSync(this._absPath);
    }
    size() {
        let { size } = fs.lstatSync(this._absPath);
        return size;
    }
}
class TxtNew {
    constructor(absPathNoExt) {
        if (!path.isAbsolute(absPathNoExt)) {
            console.error(`TxtNew constructor: passed 'absPathNoExt' NOT absolute: ${absPathNoExt}. returning`);
            return;
        }
        if (util.bool(path.extname(absPathNoExt))) {
            console.warn(`FileNew constructor: passed 'absPathNoExt' is NOT extensionless: ${absPathNoExt}. Removing ext`);
            absPathNoExt = pathx.remove_ext(absPathNoExt);
        }
        this.base = new FileNew(`${absPathNoExt}.txt`);
        this.on = new FileNew(`${absPathNoExt}_on.txt`);
        this.off = new FileNew(`${absPathNoExt}_off.txt`);
    }
    getAll() {
        return [this.base, this.on, this.off];
    }
    getExisting() {
        const files = {
            base: this.base.exists() ? this.base : undefined,
            on: this.on.exists() ? this.on : undefined,
            off: this.off.exists() ? this.off : undefined,
        };
        return files;
    }
    getMissing() {
        const files = [];
        if (!this.base.exists()) {
            files.push("base");
        }
        if (!this.on.exists()) {
            files.push("on");
        }
        if (!this.off.exists()) {
            files.push("off");
        }
        return files;
    }
    allExist() {
        return (this.base.exists()
            && this.on.exists()
            && this.off.exists());
    }
    anyExist() {
        return (this.base.exists()
            || this.on.exists()
            || this.off.exists());
    }
    removeAll() {
        if (this.base.exists())
            this.base.remove();
        if (this.on.exists())
            this.on.remove();
        if (this.off.exists())
            this.off.remove();
    }
    renameByOtherTxt(other) {
        this.base.absPath = other.base.absPath;
        this.on.absPath = other.on.absPath;
        this.off.absPath = other.off.absPath;
        fs.renameSync(this.base.absPath, other.base.absPath);
        fs.renameSync(this.on.absPath, other.on.absPath);
        fs.renameSync(this.off.absPath, other.off.absPath);
    }
}
class TruthNew {
    constructor(nameNoExt, dir) {
        let [name, ext] = pathx.split_ext(nameNoExt);
        if (util.bool(ext)) {
            console.warn(`Truth ctor, passed name is not extensionless: ${nameNoExt}. Continuing with "${name}"`);
        }
        if (name.endsWithAny('_off', '_on')) {
            name = `${name.upTo('_', true)}`;
            console.warn(`Passed path of "_on" or "_off" file and not base. Using name: "${name}"`);
        }
        this.name = name;
        if (!util.bool(dir)) {
            dir = TRUTHS_PATH_ABS;
        }
        const absPathNoExt = path.join(dir, name);
        this.txt = new TxtNew(absPathNoExt);
        this.midi = new FileNew(`${absPathNoExt}.mid`);
        this.mp4 = new FileNew(`${absPathNoExt}.mp4`);
        this.mov = new FileNew(`${absPathNoExt}.mov`);
        this.onsets = new FileNew(`${absPathNoExt}_onsets.json`);
    }
    toJSON(...include) {
        let readonlyTruth = {};
        const readonlyTxt = () => ({
            base: {
                absPath: this.txt.base.absPath
            },
            on: {
                absPath: this.txt.on.absPath
            },
            off: {
                absPath: this.txt.off.absPath
            }
        });
        const readonlySubFile = (subfile) => ({
            absPath: this[subfile].absPath
        });
        if (util.bool(include)) {
            for (let inc of include) {
                switch (inc) {
                    case "txt":
                        readonlyTruth.txt = readonlyTxt();
                        break;
                    case "midi":
                        readonlyTruth.midi = readonlySubFile("midi");
                        break;
                    case "mp4":
                        readonlyTruth.mp4 = readonlySubFile("mp4");
                        break;
                    case "onsets":
                        readonlyTruth.onsets = readonlySubFile("onsets");
                        break;
                }
            }
        }
        else {
            readonlyTruth = {
                name: this.name,
                txt: readonlyTxt(),
                mp4: readonlySubFile("mp4"),
                onsets: readonlySubFile("onsets"),
                midi: readonlySubFile("midi")
            };
        }
        return readonlyTruth;
    }
    numOfNotes() {
        if (!this.txt.on.exists()) {
            console.warn(`this.txt.on (${this.txt.on.absPath}) does not exist, returning undefined`);
            return undefined;
        }
        const strings = fs
            .readFileSync(this.txt.on.absPath, { encoding: 'utf8' })
            .split('\n');
        let notes = 0;
        for (let s of strings) {
            if (s.includes('\\')) {
                console.warn(`s includes backslash, ${this.txt.on}`);
            }
            else if (util.bool(s)) {
                notes++;
            }
        }
        return notes;
    }
}
exports.TruthNew = TruthNew;
class Txt {
    constructor(absPathNoExt) {
        if (!path.isAbsolute(absPathNoExt)) {
            console.error(`TxtNew constructor: passed 'absPathNoExt' NOT absolute: ${absPathNoExt}. returning`);
            return;
        }
        if (util.bool(path.extname(absPathNoExt))) {
            console.warn(`File constructor: passed 'absPathNoExt' is NOT extensionless: ${absPathNoExt}. Removing ext`);
            absPathNoExt = pathx.remove_ext(absPathNoExt);
        }
        this.base = new File(`${absPathNoExt}.txt`);
        this.on = new File(`${absPathNoExt}_on.txt`);
        this.off = new File(`${absPathNoExt}_off.txt`);
    }
    getAll() {
        return [this.base, this.on, this.off];
    }
    getExisting() {
        const files = {
            base: this.base.exists() ? this.base : undefined,
            on: this.on.exists() ? this.on : undefined,
            off: this.off.exists() ? this.off : undefined,
        };
        return files;
    }
    getMissing() {
        const files = [];
        if (!this.base.exists()) {
            files.push("base");
        }
        if (!this.on.exists()) {
            files.push("on");
        }
        if (!this.off.exists()) {
            files.push("off");
        }
        return files;
    }
    allExist() {
        return (this.base.exists()
            && this.on.exists()
            && this.off.exists());
    }
    anyExist() {
        return (this.base.exists()
            || this.on.exists()
            || this.off.exists());
    }
    removeAll() {
        if (this.base.exists())
            this.base.remove();
        if (this.on.exists())
            this.on.remove();
        if (this.off.exists())
            this.off.remove();
    }
    renameByOtherTxt(other) {
        this.base.path = other.base.path;
        this.on.path = other.on.path;
        this.off.path = other.off.path;
        fs.renameSync(this.base.path, other.base.path);
        fs.renameSync(this.on.path, other.on.path);
        fs.renameSync(this.off.path, other.off.path);
    }
}
class File {
    constructor(pathWithExt) {
        if (!util.bool(path.extname(pathWithExt))) {
            alert(`File constructor: passed 'pathWithExt' is extensionless: ${pathWithExt}`);
        }
        this.path = pathWithExt;
        if (path.isAbsolute(this.path)) {
            this.name = new File(path.basename(this.path));
        }
        else {
            this.name = undefined;
        }
    }
    get pathNoExt() {
        return pathx.remove_ext(this.path);
    }
    renameByOtherFile(other) {
        fs.renameSync(this.path, other.path);
        this.path = other.path;
    }
    renameByCTime() {
        const stats = fs.lstatSync(this.path);
        const datestr = stats.ctime.human();
        const newPath = pathx.push_before_ext(this.path, `__CREATED_${datestr}`);
        console.log('renameByCTime() to: ', newPath);
        fs.renameSync(this.path, newPath);
    }
    getBitrateAndHeight() {
        if (!this.path.endsWith('mp4') && !this.path.endsWith('mov')) {
            console.warn(`FileNew: "${this.path}" isn't "mp4" or "mov"`);
            return undefined;
        }
        const { execSync } = require('child_process');
        const ffprobeCmd = `ffprobe -v quiet -print_format json -show_streams -show_format`;
        const probe = JSON.parse(execSync(`${ffprobeCmd} "${this.path}"`, { encoding: 'utf8' }));
        const { bit_rate, height } = probe.streams.find(s => s["codec_type"] == "video");
        return [bit_rate, height];
    }
    exists() {
        return fs.existsSync(this.path);
    }
    remove() {
        fs.unlinkSync(this.path);
    }
    size() {
        let { size } = fs.lstatSync(this.path);
        return size;
    }
}
exports.File = File;
class Truth {
    constructor(pathNoExt) {
        if (!path.isAbsolute(pathNoExt)) {
            alert(`Passed path is not absolute: ${pathNoExt}`);
        }
        if (util.bool(path.extname(pathNoExt))) {
            alert(`Passed path is not extensionless: ${pathNoExt}`);
        }
        if (pathNoExt.endsWith('off') || pathNoExt.endsWith('on')) {
            alert(`Passed path of "_on" or "_off" file and not base: ${pathNoExt}`);
        }
        this.pathNoExt = pathNoExt;
        this.name = path.basename(this.pathNoExt);
        this.txt = new Txt(this.pathNoExt);
        this.midi = new File(`${this.pathNoExt}.mid`);
        this.mp4 = new File(`${this.pathNoExt}.mp4`);
        this.mov = new File(`${this.pathNoExt}.mov`);
        this.onsets = new File(`${this.pathNoExt}_onsets.json`);
    }
    numOfNotes() {
        if (!this.txt.on.exists()) {
            console.warn(`this.txt.on (${this.txt.on.path}) does not exist, returning undefined`);
            return undefined;
        }
        const strings = fs
            .readFileSync(this.txt.on.path, { encoding: 'utf8' })
            .split('\n');
        let notes = 0;
        for (let s of strings) {
            if (s.includes('\\')) {
                console.warn(`s includes backslash, ${this.txt.on}`);
            }
            else if (util.bool(s)) {
                notes++;
            }
        }
        return notes;
    }
}
exports.Truth = Truth;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDZCQUE2QjtBQUM3Qix5QkFBd0I7QUFFeEIsZ0NBQWdDO0FBQ2hDLGtDQUFrQztBQUdsQyxNQUFNLE9BQU87SUFFVCxZQUFZLGNBQXNCO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsRUFBRTtZQUMxQyxPQUFPLENBQUMsS0FBSyxDQUFDLGtFQUFrRSxjQUFjLGFBQWEsQ0FBQyxDQUFDO1NBQ2hIO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLEVBQUU7WUFDbEMsT0FBTyxDQUFDLEtBQUssQ0FBQyw4REFBOEQsY0FBYyxhQUFhLENBQUMsQ0FBQztTQUM1RztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsY0FBYyxDQUFDO0lBS25DLENBQUM7SUFLRCxJQUFJLE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDekIsQ0FBQztJQUdELElBQUksT0FBTyxDQUFDLGNBQXNCO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUMsRUFBRTtZQUMxQyxPQUFPLENBQUMsS0FBSyxDQUFDLCtEQUErRCxjQUFjLGVBQWUsQ0FBQyxDQUFDO1lBQzVHLE9BQU87U0FDVjtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxFQUFFO1lBQ2xDLE9BQU8sQ0FBQyxLQUFLLENBQUMsOERBQThELGNBQWMsZUFBZSxDQUFDLENBQUM7WUFDM0csT0FBTztTQUNWO1FBQ0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxjQUFjLENBQUM7UUFDL0IsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLGNBQWMs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QUUsRUFBRTtZQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLGdCQUFnQixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLHVDQUF1QyxDQUFDLENBQUM7WUFDdEYsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFDRCxNQUFNLE9BQU8sR0FBRyxFQUFFO2FBQ2IsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUNwRCxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakIsSUFBSSxLQUFLLEdBQVcsQ0FBQyxDQUFDO1FBQ3RCLEtBQUssSUFBSSxDQUFDLElBQUksT0FBTyxFQUFFO1lBQ25CLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDbEIsT0FBTyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQ3hEO2lCQUFNLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDckIsS0FBSyxFQUFFLENBQUM7YUFDWDtTQUVKO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztDQUNKO0FBMURELHNCQTBEQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJ1xuXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gXCIuLi91dGlsXCI7XG5pbXBvcnQgKiBhcyBwYXRoeCBmcm9tIFwiLi4vcGF0aHhcIjtcblxuLyoqQW4gb2JqZWN0IHdyYXBwaW5nIGFuIGFicyBwYXRoIHdpdGggZXh0ZW5zaW9uLiovXG5jbGFzcyBGaWxlTmV3IHtcblxuICAgIGNvbnN0cnVjdG9yKGFic1BhdGhXaXRoRXh0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCF1dGlsLmJvb2wocGF0aC5leHRuYW1lKGFic1BhdGhXaXRoRXh0KSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZpbGVOZXcgY29uc3RydWN0b3I6IHBhc3NlZCAnYWJzUGF0aFdpdGhFeHQnIGlzIGV4dGVuc2lvbmxlc3M6ICR7YWJzUGF0aFdpdGhFeHR9LiBSZXR1cm5pbmdgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZShhYnNQYXRoV2l0aEV4dCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZpbGVOZXcgY29uc3RydWN0b3I6IHBhc3NlZCAnYWJzUGF0aFdpdGhFeHQnIE5PVCBhYnNvbHV0ZTogJHthYnNQYXRoV2l0aEV4dH0uIFJldHVybmluZ2ApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fYWJzUGF0aCA9IGFic1BhdGhXaXRoRXh0O1xuXG4gICAgICAgIC8vIHRoaXMucGF0aE5vRXh0ID0gbXlmcy5yZW1vdmVfZXh0KGFic1BhdGhXaXRoRXh0KTtcblxuXG4gICAgfVxuXG4gICAgLyoqVGhlIGFicyBwYXRoIFdJVEggZXh0ZW5zaW9uKi9cbiAgICBwcml2YXRlIF9hYnNQYXRoOiBzdHJpbmc7XG5cbiAgICBnZXQgYWJzUGF0aCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWJzUGF0aDtcbiAgICB9XG5cbiAgICAvKipTZXRzIHRoaXMuX2Fic1BhdGggYW5kIGFsc28gUkVOQU1FUyB0aGUgYWN0dWFsIGZpbGUuKi9cbiAgICBzZXQgYWJzUGF0aChhYnNQYXRoV2l0aEV4dDogc3RyaW5nKSB7XG4gICAgICAgIGlmICghdXRpbC5ib29sKHBhdGguZXh0bmFtZShhYnNQYXRoV2l0aEV4dCkpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGaWxlTmV3IHNldCBhYnNQYXRoOiBwYXNzZWQgZXh0ZW5zaW9ubGVzcyAnYWJzUGF0aFdpdGhFeHQnOiAke2Fic1BhdGhXaXRoRXh0fS4gTm90IHNldHRpbmdgKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZShhYnNQYXRoV2l0aEV4dCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZpbGVOZXcgc2V0IGFic1BhdGg6IHBhc3NlZCBub24tYWJzb2x1dGUgJ2Fic1BhdGhXaXRoRXh0JzogJHthYnNQYXRoV2l0aEV4dH0uIE5vdCBzZXR0aW5nYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYWJzUGF0aCA9IGFic1BhdGhXaXRoRXh0O1xuICAgICAgICBmcy5yZW5hbWVTeW5jKHRoaXMuX2Fic1BhdGgsIGFic1BhdGhXaXRoRXh0KTtcbiAgICB9XG5cbiAgICAvKnRvU3RyaW5nKCkge1xuICAgICByZXR1cm4gdGhpcy5wYXRoO1xuICAgICB9Ki9cbiAgICAvKipAZGVwcmVjYXRlZCovXG4gICAgcmVuYW1lQnlPdGhlckZpbGUob3RoZXI6IEZpbGVOZXcpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdjYWxsZWQgcmVuYW1lQnlPdGhlckZpbGUoKSwgdXNlIHNldCBhYnNQYXRoIGluc3RlYWQnKTtcbiAgICAgICAgdGhpcy5hYnNQYXRoID0gb3RoZXIuYWJzUGF0aDtcbiAgICB9XG5cbiAgICByZW5hbWVCeUNUaW1lKCkge1xuICAgICAgICBjb25zdCBzdGF0cyA9IGZzLmxzdGF0U3luYyh0aGlzLmFic1BhdGgpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IGRhdGVzdHIgPSBzdGF0cy5jdGltZS5odW1hbigpO1xuICAgICAgICBjb25zdCBuZXdQYXRoID0gcGF0aHgucHVzaF9iZWZvcmVfZXh0KHRoaXMuYWJzUGF0aCwgYF9fQ1JFQVRFRF8ke2RhdGVzdHJ9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZW5hbWVCeUNUaW1lKCkgdG86ICcsIG5ld1BhdGgpO1xuICAgICAgICB0aGlzLmFic1BhdGggPSBuZXdQYXRoO1xuICAgIH1cblxuXG4gICAgYXN5bmMgZ2V0Qml0cmF0ZUFuZEhlaWdodCgpOiBQcm9taXNlPFtzdHJpbmcsIHN0cmluZ10+IHtcbiAgICAgICAgaWYgKCF0aGlzLl9hYnNQYXRoLmVuZHNXaXRoKCdtcDQnKSAmJiAhdGhpcy5fYWJzUGF0aC5lbmRzV2l0aCgnbW92JykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmlsZU5ldzogXCIke3RoaXMuX2Fic1BhdGh9XCIgaXNuJ3QgXCJtcDRcIiBvciBcIm1vdlwiYCk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBleGVjU3luYyB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuICAgICAgICBjb25zdCBmZnByb2JlQ21kID0gYGZmcHJvYmUgLXYgcXVpZXQgLXByaW50X2Zvcm1hdCBqc29uIC1zaG93X3N0cmVhbXMgLXNob3dfZm9ybWF0YDtcbiAgICAgICAgY29uc3QgcHJvYmUgPSBKU09OLnBhcnNlKGV4ZWNTeW5jKGAke2ZmcHJvYmVDbWR9IFwiJHt0aGlzLl9hYnNQYXRofVwiYCwgeyBlbmNvZGluZzogJ3V0ZjgnIH0pKTtcbiAgICAgICAgY29uc3QgeyBiaXRfcmF0ZSwgaGVpZ2h0IH0gPSBwcm9iZS5zdHJlYW1zLmZpbmQocyA9PiBzW1wiY29kZWNfdHlwZVwiXSA9PT0gXCJ2aWRlb1wiKTtcbiAgICAgICAgcmV0dXJuIFtiaXRfcmF0ZSwgaGVpZ2h0XTtcbiAgICB9XG5cblxuICAgIGV4aXN0cygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZzLmV4aXN0c1N5bmModGhpcy5fYWJzUGF0aCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlKCkge1xuICAgICAgICBmcy51bmxpbmtTeW5jKHRoaXMuX2Fic1BhdGgpO1xuICAgIH1cblxuICAgIHNpemUoKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IHsgc2l6ZSB9ID0gZnMubHN0YXRTeW5jKHRoaXMuX2Fic1BhdGgpO1xuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9XG59XG5cblxuY2xhc3MgVHh0TmV3IHtcbiAgICAvKipBIEZpbGVOZXcgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYWJzb2x1dGUgYGAqLnR4dGBgIHBhdGguKi9cbiAgICByZWFkb25seSBiYXNlOiBGaWxlTmV3O1xuICAgIC8qKkEgRmlsZU5ldyBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBhYnNvbHV0ZSBgYCpfb24udHh0YGAgIHBhdGguKi9cbiAgICByZWFkb25seSBvbjogRmlsZU5ldztcbiAgICAvKipBIEZpbGVOZXcgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYWJzb2x1dGUgYGAqX29mZi50eHRgYCBwYXRoLiovXG4gICAgcmVhZG9ubHkgb2ZmOiBGaWxlTmV3O1xuXG5cbiAgICBjb25zdHJ1Y3RvcihhYnNQYXRoTm9FeHQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZShhYnNQYXRoTm9FeHQpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBUeHROZXcgY29uc3RydWN0b3I6IHBhc3NlZCAnYWJzUGF0aE5vRXh0JyBOT1QgYWJzb2x1dGU6ICR7YWJzUGF0aE5vRXh0fS4gcmV0dXJuaW5nYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHV0aWwuYm9vbChwYXRoLmV4dG5hbWUoYWJzUGF0aE5vRXh0KSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmlsZU5ldyBjb25zdHJ1Y3RvcjogcGFzc2VkICdhYnNQYXRoTm9FeHQnIGlzIE5PVCBleHRlbnNpb25sZXNzOiAke2Fic1BhdGhOb0V4dH0uIFJlbW92aW5nIGV4dGApO1xuICAgICAgICAgICAgYWJzUGF0aE5vRXh0ID0gcGF0aHgucmVtb3ZlX2V4dChhYnNQYXRoTm9FeHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmFzZSA9IG5ldyBGaWxlTmV3KGAke2Fic1BhdGhOb0V4dH0udHh0YCk7XG4gICAgICAgIHRoaXMub24gPSBuZXcgRmlsZU5ldyhgJHthYnNQYXRoTm9FeHR9X29uLnR4dGApO1xuICAgICAgICB0aGlzLm9mZiA9IG5ldyBGaWxlTmV3KGAke2Fic1BhdGhOb0V4dH1fb2ZmLnR4dGApO1xuXG4gICAgfVxuXG4gICAgZ2V0QWxsKCk6IFtGaWxlTmV3LCBGaWxlTmV3LCBGaWxlTmV3XSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5iYXNlLCB0aGlzLm9uLCB0aGlzLm9mZl07XG4gICAgfVxuXG5cbiAgICAvLyBnZXRFeGlzdGluZygpOiBbIChGaWxlIHwgZmFsc2UpLCAoRmlsZSB8IGZhbHNlKSwgKEZpbGUgfCBmYWxzZSkgXSB7XG4gICAgZ2V0RXhpc3RpbmcoKTogeyBiYXNlPzogRmlsZU5ldywgb24/OiBGaWxlTmV3LCBvZmY/OiBGaWxlTmV3IH0ge1xuICAgICAgICBjb25zdCBmaWxlcyA9IHtcbiAgICAgICAgICAgIGJhc2U6IHRoaXMuYmFzZS5leGlzdHMoKSA/IHRoaXMuYmFzZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uOiB0aGlzLm9uLmV4aXN0cygpID8gdGhpcy5vbiA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9mZjogdGhpcy5vZmYuZXhpc3RzKCkgPyB0aGlzLm9mZiA6IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZmlsZXM7XG4gICAgfVxuXG4gICAgZ2V0TWlzc2luZygpOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gW107XG4gICAgICAgIGlmICghdGhpcy5iYXNlLmV4aXN0cygpKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKFwiYmFzZVwiKVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5vbi5leGlzdHMoKSkge1xuICAgICAgICAgICAgZmlsZXMucHVzaChcIm9uXCIpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLm9mZi5leGlzdHMoKSkge1xuICAgICAgICAgICAgZmlsZXMucHVzaChcIm9mZlwiKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxlcztcblxuICAgIH1cblxuICAgIGFsbEV4aXN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy5iYXNlLmV4aXN0cygpXG4gICAgICAgICAgICAmJiB0aGlzLm9uLmV4aXN0cygpXG4gICAgICAgICAgICAmJiB0aGlzLm9mZi5leGlzdHMoKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGFueUV4aXN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy5iYXNlLmV4aXN0cygpXG4gICAgICAgICAgICB8fCB0aGlzLm9uLmV4aXN0cygpXG4gICAgICAgICAgICB8fCB0aGlzLm9mZi5leGlzdHMoKVxuICAgICAgICApO1xuXG4gICAgfVxuXG4gICAgcmVtb3ZlQWxsKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5iYXNlLmV4aXN0cygpKVxuICAgICAgICAgICAgdGhpcy5iYXNlLnJlbW92ZSgpO1xuICAgICAgICBpZiAodGhpcy5vbi5leGlzdHMoKSlcbiAgICAgICAgICAgIHRoaXMub24ucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLm9mZi5leGlzdHMoKSlcbiAgICAgICAgICAgIHRoaXMub2ZmLnJlbW92ZSgpO1xuXG4gICAgfVxuXG4gICAgcmVuYW1lQnlPdGhlclR4dChvdGhlcjogVHh0TmV3KTogdm9pZCB7XG4gICAgICAgIC8vIGNvbnNvbGUud2FybigncmVuYW1lQnlPdGhlclR4dDogZGlkbnQgc2V0IG5ldyB0aGlzIGJhc2UgLyBvbiAvIG9mZicpO1xuICAgICAgICB0aGlzLmJhc2UuYWJzUGF0aCA9IG90aGVyLmJhc2UuYWJzUGF0aDtcbiAgICAgICAgdGhpcy5vbi5hYnNQYXRoID0gb3RoZXIub24uYWJzUGF0aDtcbiAgICAgICAgdGhpcy5vZmYuYWJzUGF0aCA9IG90aGVyLm9mZi5hYnNQYXRoO1xuICAgICAgICBmcy5yZW5hbWVTeW5jKHRoaXMuYmFzZS5hYnNQYXRoLCBvdGhlci5iYXNlLmFic1BhdGgpO1xuICAgICAgICBmcy5yZW5hbWVTeW5jKHRoaXMub24uYWJzUGF0aCwgb3RoZXIub24uYWJzUGF0aCk7XG4gICAgICAgIGZzLnJlbmFtZVN5bmModGhpcy5vZmYuYWJzUGF0aCwgb3RoZXIub2ZmLmFic1BhdGgpO1xuXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlYWRvbmx5VHJ1dGgge1xuICAgIC8qKlRoZSBiYXNlbmFtZSB3aXRob3V0IGV4dGVuc2lvbi4qL1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICB0eHQ6IHtcbiAgICAgICAgYmFzZToge1xuICAgICAgICAgICAgYWJzUGF0aDogc3RyaW5nXG4gICAgICAgIH0sXG4gICAgICAgIG9uOiB7XG4gICAgICAgICAgICBhYnNQYXRoOiBzdHJpbmdcbiAgICAgICAgfSxcbiAgICAgICAgb2ZmOiB7XG4gICAgICAgICAgICBhYnNQYXRoOiBzdHJpbmdcbiAgICAgICAgfVxuICAgIH0sXG4gICAgbWlkaTogeyBhYnNQYXRoOiBzdHJpbmcgfSxcbiAgICBtcDQ6IHsgYWJzUGF0aDogc3RyaW5nIH0sXG4gICAgb25zZXRzOiB7IGFic1BhdGg6IHN0cmluZyB9LFxufVxuXG5leHBvcnQgY2xhc3MgVHJ1dGhOZXcgaW1wbGVtZW50cyBSZWFkb25seVRydXRoIHtcblxuICAgIC8qKlRoZSBiYXNlbmFtZSB3aXRob3V0IGV4dGVuc2lvbi4qL1xuICAgIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgICByZWFkb25seSB0eHQ6IFR4dE5ldztcbiAgICAvKipBIEZpbGVOZXcgb2JqZWN0IG9mIHRoZSBtaWRpIGZpbGUuKi9cbiAgICByZWFkb25seSBtaWRpOiBGaWxlTmV3O1xuICAgIC8qKkEgRmlsZU5ldyBvYmplY3Qgb2YgdGhlIG1wNCBmaWxlLiovXG4gICAgcmVhZG9ubHkgbXA0OiBGaWxlTmV3O1xuICAgIC8qKkEgRmlsZU5ldyBvYmplY3Qgb2YgdGhlIG1vdiBmaWxlLiovXG4gICAgcmVhZG9ubHkgbW92OiBGaWxlTmV3O1xuICAgIC8qKkEgRmlsZU5ldyBvYmplY3Qgb2YgdGhlIG9uc2V0cyBmaWxlLiovXG4gICAgcmVhZG9ubHkgb25zZXRzOiBGaWxlTmV3O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIG5hbWVOb0V4dCAtIEV4cGVjdHMgYSBmaWxlIGJhc2UgbmFtZSB3aXRoIG5vIGV4dGVuc2lvbi5cbiAgICAgKiBAcGFyYW0gZGlyIC0gT3B0aW9uYWwgYWJzIGRpciBwYXRoIG9mIHRoZSB0cnV0aC4gRGVmYXVsdHMgdG8gYFRSVVRIU19QQVRIX0FCU2BcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihuYW1lTm9FeHQ6IHN0cmluZywgZGlyPzogc3RyaW5nKSB7XG4gICAgICAgIGxldCBbbmFtZSwgZXh0XSA9IHBhdGh4LnNwbGl0X2V4dChuYW1lTm9FeHQpO1xuXG4gICAgICAgIGlmICh1dGlsLmJvb2woZXh0KSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBUcnV0aCBjdG9yLCBwYXNzZWQgbmFtZSBpcyBub3QgZXh0ZW5zaW9ubGVzczogJHtuYW1lTm9FeHR9LiBDb250aW51aW5nIHdpdGggXCIke25hbWV9XCJgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuYW1lLmVuZHNXaXRoQW55KCdfb2ZmJywgJ19vbicpKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBUSElTIElTIEJVR0dZXG4gICAgICAgICAgICBuYW1lID0gYCR7bmFtZS51cFRvKCdfJywgdHJ1ZSl9YDtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgUGFzc2VkIHBhdGggb2YgXCJfb25cIiBvciBcIl9vZmZcIiBmaWxlIGFuZCBub3QgYmFzZS4gVXNpbmcgbmFtZTogXCIke25hbWV9XCJgKTtcblxuICAgICAgICB9XG5cblxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICBpZiAoIXV0aWwuYm9vbChkaXIpKSB7XG4gICAgICAgICAgICBkaXIgPSBUUlVUSFNfUEFUSF9BQlM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWJzUGF0aE5vRXh0ID0gcGF0aC5qb2luKGRpciwgbmFtZSk7XG4gICAgICAgIHRoaXMudHh0ID0gbmV3IFR4dE5ldyhhYnNQYXRoTm9FeHQpO1xuICAgICAgICB0aGlzLm1pZGkgPSBuZXcgRmlsZU5ldyhgJHthYnNQYXRoTm9FeHR9Lm1pZGApO1xuICAgICAgICB0aGlzLm1wNCA9IG5ldyBGaWxlTmV3KGAke2Fic1BhdGhOb0V4dH0ubXA0YCk7XG4gICAgICAgIHRoaXMubW92ID0gbmV3IEZpbGVOZXcoYCR7YWJzUGF0aE5vRXh0fS5tb3ZgKTtcbiAgICAgICAgdGhpcy5vbnNldHMgPSBuZXcgRmlsZU5ldyhgJHthYnNQYXRoTm9FeHR9X29uc2V0cy5qc29uYCk7XG5cbiAgICB9XG5cbiAgICB0b0pTT04oLi4uaW5jbHVkZTogKFwidHh0XCIgfCBcIm1pZGlcIiB8IFwibXA0XCIgfCBcIm9uc2V0c1wiKVtdKTogUmVhZG9ubHlUcnV0aCB7XG4gICAgICAgIGxldCByZWFkb25seVRydXRoID0ge30gYXMgUmVhZG9ubHlUcnV0aDtcbiAgICAgICAgY29uc3QgcmVhZG9ubHlUeHQgPSAoKSA9PiAoe1xuICAgICAgICAgICAgYmFzZToge1xuICAgICAgICAgICAgICAgIGFic1BhdGg6IHRoaXMudHh0LmJhc2UuYWJzUGF0aFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uOiB7XG4gICAgICAgICAgICAgICAgYWJzUGF0aDogdGhpcy50eHQub24uYWJzUGF0aFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9mZjoge1xuICAgICAgICAgICAgICAgIGFic1BhdGg6IHRoaXMudHh0Lm9mZi5hYnNQYXRoXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCByZWFkb25seVN1YkZpbGUgPSAoc3ViZmlsZTogXCJtaWRpXCIgfCBcIm1wNFwiIHwgXCJvbnNldHNcIikgPT4gKHtcbiAgICAgICAgICAgIGFic1BhdGg6IHRoaXNbc3ViZmlsZV0uYWJzUGF0aFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHV0aWwuYm9vbChpbmNsdWRlKSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaW5jIG9mIGluY2x1ZGUpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGluYykge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwidHh0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkb25seVRydXRoLnR4dCA9IHJlYWRvbmx5VHh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1pZGlcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRvbmx5VHJ1dGgubWlkaSA9IHJlYWRvbmx5U3ViRmlsZShcIm1pZGlcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1wNFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZG9ubHlUcnV0aC5tcDQgPSByZWFkb25seVN1YkZpbGUoXCJtcDRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm9uc2V0c1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZG9ubHlUcnV0aC5vbnNldHMgPSByZWFkb25seVN1YkZpbGUoXCJvbnNldHNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlYWRvbmx5VHJ1dGggPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIHR4dDogcmVhZG9ubHlUeHQoKSxcbiAgICAgICAgICAgICAgICBtcDQ6IHJlYWRvbmx5U3ViRmlsZShcIm1wNFwiKSxcbiAgICAgICAgICAgICAgICBvbnNldHM6IHJlYWRvbmx5U3ViRmlsZShcIm9uc2V0c1wiKSxcbiAgICAgICAgICAgICAgICBtaWRpOiByZWFkb25seVN1YkZpbGUoXCJtaWRpXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlYWRvbmx5VHJ1dGg7XG5cbiAgICB9XG5cbiAgICAvKipDb3VudHMgdGhlIG51bWJlciBvZiBub24tZW1wdHkgbGluZXMgaW4gdGhlIHR4dCBvbiBwYXRoIGZpbGUuKi9cbiAgICBudW1PZk5vdGVzKCk6IG51bWJlciB7XG4gICAgICAgIGlmICghdGhpcy50eHQub24uZXhpc3RzKCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgdGhpcy50eHQub24gKCR7dGhpcy50eHQub24uYWJzUGF0aH0pIGRvZXMgbm90IGV4aXN0LCByZXR1cm5pbmcgdW5kZWZpbmVkYCk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RyaW5ncyA9IGZzXG4gICAgICAgICAgICAucmVhZEZpbGVTeW5jKHRoaXMudHh0Lm9uLmFic1BhdGgsIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KVxuICAgICAgICAgICAgLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgbGV0IG5vdGVzOiBudW1iZXIgPSAwO1xuICAgICAgICBmb3IgKGxldCBzIG9mIHN0cmluZ3MpIHtcbiAgICAgICAgICAgIGlmIChzLmluY2x1ZGVzKCdcXFxcJykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYHMgaW5jbHVkZXMgYmFja3NsYXNoLCAke3RoaXMudHh0Lm9ufWApO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1dGlsLmJvb2wocykpIHtcbiAgICAgICAgICAgICAgICBub3RlcysrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vdGVzO1xuICAgIH1cbn1cblxuY2xhc3MgVHh0IHtcbiAgICAvKipBIEZpbGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYWJzb2x1dGUgYGAqLnR4dGBgIHBhdGguKi9cbiAgICByZWFkb25seSBiYXNlOiBGaWxlO1xuICAgIC8qKkEgRmlsZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBhYnNvbHV0ZSBgYCpfb24udHh0YGAgIHBhdGguKi9cbiAgICByZWFkb25seSBvbjogRmlsZTtcbiAgICAvKipBIEZpbGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYWJzb2x1dGUgYGAqX29mZi50eHRgYCBwYXRoLiovXG4gICAgcmVhZG9ubHkgb2ZmOiBGaWxlO1xuXG5cbiAgICBjb25zdHJ1Y3RvcihhYnNQYXRoTm9FeHQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXBhdGguaXNBYnNvbHV0ZShhYnNQYXRoTm9FeHQpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBUeHROZXcgY29uc3RydWN0b3I6IHBhc3NlZCAnYWJzUGF0aE5vRXh0JyBOT1QgYWJzb2x1dGU6ICR7YWJzUGF0aE5vRXh0fS4gcmV0dXJuaW5nYCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHV0aWwuYm9vbChwYXRoLmV4dG5hbWUoYWJzUGF0aE5vRXh0KSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmlsZSBjb25zdHJ1Y3RvcjogcGFzc2VkICdhYnNQYXRoTm9FeHQnIGlzIE5PVCBleHRlbnNpb25sZXNzOiAke2Fic1BhdGhOb0V4dH0uIFJlbW92aW5nIGV4dGApO1xuICAgICAgICAgICAgYWJzUGF0aE5vRXh0ID0gcGF0aHgucmVtb3ZlX2V4dChhYnNQYXRoTm9FeHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmFzZSA9IG5ldyBGaWxlKGAke2Fic1BhdGhOb0V4dH0udHh0YCk7XG4gICAgICAgIHRoaXMub24gPSBuZXcgRmlsZShgJHthYnNQYXRoTm9FeHR9X29uLnR4dGApO1xuICAgICAgICB0aGlzLm9mZiA9IG5ldyBGaWxlKGAke2Fic1BhdGhOb0V4dH1fb2ZmLnR4dGApO1xuXG4gICAgfVxuXG4gICAgZ2V0QWxsKCk6IFtGaWxlLCBGaWxlLCBGaWxlXSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5iYXNlLCB0aGlzLm9uLCB0aGlzLm9mZl07XG4gICAgfVxuXG5cbiAgICAvLyBnZXRFeGlzdGluZygpOiBbIChGaWxlIHwgZmFsc2UpLCAoRmlsZSB8IGZhbHNlKSwgKEZpbGUgfCBmYWxzZSkgXSB7XG4gICAgZ2V0RXhpc3RpbmcoKTogeyBiYXNlPzogRmlsZSwgb24/OiBGaWxlLCBvZmY/OiBGaWxlIH0ge1xuICAgICAgICBjb25zdCBmaWxlcyA9IHtcbiAgICAgICAgICAgIGJhc2U6IHRoaXMuYmFzZS5leGlzdHMoKSA/IHRoaXMuYmFzZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uOiB0aGlzLm9uLmV4aXN0cygpID8gdGhpcy5vbiA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9mZjogdGhpcy5vZmYuZXhpc3RzKCkgPyB0aGlzLm9mZiA6IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZmlsZXM7XG4gICAgfVxuXG4gICAgZ2V0TWlzc2luZygpOiBzdHJpbmdbXSB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gW107XG4gICAgICAgIGlmICghdGhpcy5iYXNlLmV4aXN0cygpKSB7XG4gICAgICAgICAgICBmaWxlcy5wdXNoKFwiYmFzZVwiKVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5vbi5leGlzdHMoKSkge1xuICAgICAgICAgICAgZmlsZXMucHVzaChcIm9uXCIpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLm9mZi5leGlzdHMoKSkge1xuICAgICAgICAgICAgZmlsZXMucHVzaChcIm9mZlwiKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxlcztcblxuICAgIH1cblxuICAgIGFsbEV4aXN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy5iYXNlLmV4aXN0cygpXG4gICAgICAgICAgICAmJiB0aGlzLm9uLmV4aXN0cygpXG4gICAgICAgICAgICAmJiB0aGlzLm9mZi5leGlzdHMoKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGFueUV4aXN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy5iYXNlLmV4aXN0cygpXG4gICAgICAgICAgICB8fCB0aGlzLm9uLmV4aXN0cygpXG4gICAgICAgICAgICB8fCB0aGlzLm9mZi5leGlzdHMoKVxuICAgICAgICApO1xuXG4gICAgfVxuXG4gICAgcmVtb3ZlQWxsKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5iYXNlLmV4aXN0cygpKVxuICAgICAgICAgICAgdGhpcy5iYXNlLnJlbW92ZSgpO1xuICAgICAgICBpZiAodGhpcy5vbi5leGlzdHMoKSlcbiAgICAgICAgICAgIHRoaXMub24ucmVtb3ZlKCk7XG4gICAgICAgIGlmICh0aGlzLm9mZi5leGlzdHMoKSlcbiAgICAgICAgICAgIHRoaXMub2ZmLnJlbW92ZSgpO1xuXG4gICAgfVxuXG4gICAgcmVuYW1lQnlPdGhlclR4dChvdGhlcjogVHh0KTogdm9pZCB7XG4gICAgICAgIC8vIGNvbnNvbGUud2FybigncmVuYW1lQnlPdGhlclR4dDogZGlkbnQgc2V0IG5ldyB0aGlzIGJhc2UgLyBvbiAvIG9mZicpO1xuXG4gICAgICAgIHRoaXMuYmFzZS5wYXRoID0gb3RoZXIuYmFzZS5wYXRoO1xuICAgICAgICB0aGlzLm9uLnBhdGggPSBvdGhlci5vbi5wYXRoO1xuICAgICAgICB0aGlzLm9mZi5wYXRoID0gb3RoZXIub2ZmLnBhdGg7XG4gICAgICAgIGZzLnJlbmFtZVN5bmModGhpcy5iYXNlLnBhdGgsIG90aGVyLmJhc2UucGF0aCk7XG4gICAgICAgIGZzLnJlbmFtZVN5bmModGhpcy5vbi5wYXRoLCBvdGhlci5vbi5wYXRoKTtcbiAgICAgICAgZnMucmVuYW1lU3luYyh0aGlzLm9mZi5wYXRoLCBvdGhlci5vZmYucGF0aCk7XG5cbiAgICB9XG59XG5cbi8qKkFuIG9iamVjdCB3cmFwcGluZyBhIHBhdGggd2l0aCBleHRlbnNpb24uIENhbiBiZSBhYnNvbHV0ZSBvciBiYXNlLlxuICogYHRvU3RyaW5nKClgIHJldHVybnMgYHRoaXMucGF0aGAuXG4gKiBgbmFtZWAgcHJvcGVydHkgZXhpc3RzIG9ubHkgaWYgd3JhcHBpbmcgYW4gYWJzb2x1dGUgcGF0aC4qL1xuZXhwb3J0IGNsYXNzIEZpbGUge1xuICAgIC8qKlRoZSBwYXRoIGluY2x1ZGluZyBleHRlbnNpb24uIENhbiBiZSBlaXRoZXIgYWJzb2x1dGUgb3IgYSBmaWxlIG5hbWUqL1xuICAgIHBhdGg6IHN0cmluZztcbiAgICAvKipJZiBkZWZpbmVkLCBhIEZpbGUgb2JqZWN0IG9mIHRoZSBiYXNlbmFtZS4qL1xuICAgIG5hbWU/OiBGaWxlO1xuXG4gICAgY29uc3RydWN0b3IocGF0aFdpdGhFeHQpIHtcbiAgICAgICAgaWYgKCF1dGlsLmJvb2wocGF0aC5leHRuYW1lKHBhdGhXaXRoRXh0KSkpIHtcbiAgICAgICAgICAgIGFsZXJ0KGBGaWxlIGNvbnN0cnVjdG9yOiBwYXNzZWQgJ3BhdGhXaXRoRXh0JyBpcyBleHRlbnNpb25sZXNzOiAke3BhdGhXaXRoRXh0fWApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aFdpdGhFeHQ7XG5cbiAgICAgICAgaWYgKHBhdGguaXNBYnNvbHV0ZSh0aGlzLnBhdGgpKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuZXcgRmlsZShwYXRoLmJhc2VuYW1lKHRoaXMucGF0aCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvKnRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGg7XG4gICAgfSovXG4gICAgLyoqVGhlIHBhdGggd2l0aG91dCBleHRlbnNpb24uIENhbiBiZSBlaXRoZXIgYWJzb2x1dGUgb3IgYSBmaWxlIG5hbWUuKi9cbiAgICBnZXQgcGF0aE5vRXh0KCkge1xuICAgICAgICByZXR1cm4gcGF0aHgucmVtb3ZlX2V4dCh0aGlzLnBhdGgpXG4gICAgfVxuXG4gICAgcmVuYW1lQnlPdGhlckZpbGUob3RoZXI6IEZpbGUpOiB2b2lkIHtcbiAgICAgICAgZnMucmVuYW1lU3luYyh0aGlzLnBhdGgsIG90aGVyLnBhdGgpO1xuICAgICAgICB0aGlzLnBhdGggPSBvdGhlci5wYXRoXG4gICAgfVxuXG4gICAgcmVuYW1lQnlDVGltZSgpOiB2b2lkIHtcblxuICAgICAgICBjb25zdCBzdGF0czogZnMuU3RhdHMgPSBmcy5sc3RhdFN5bmModGhpcy5wYXRoKTtcbiAgICAgICAgY29uc3QgZGF0ZXN0ciA9IHN0YXRzLmN0aW1lLmh1bWFuKCk7XG4gICAgICAgIGNvbnN0IG5ld1BhdGggPSBwYXRoeC5wdXNoX2JlZm9yZV9leHQodGhpcy5wYXRoLCBgX19DUkVBVEVEXyR7ZGF0ZXN0cn1gKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlbmFtZUJ5Q1RpbWUoKSB0bzogJywgbmV3UGF0aCk7XG4gICAgICAgIGZzLnJlbmFtZVN5bmModGhpcy5wYXRoLCBuZXdQYXRoKTtcbiAgICB9XG5cblxuICAgIGdldEJpdHJhdGVBbmRIZWlnaHQoKTogW2FueSwgYW55XSB7XG4gICAgICAgIGlmICghdGhpcy5wYXRoLmVuZHNXaXRoKCdtcDQnKSAmJiAhdGhpcy5wYXRoLmVuZHNXaXRoKCdtb3YnKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBGaWxlTmV3OiBcIiR7dGhpcy5wYXRofVwiIGlzbid0IFwibXA0XCIgb3IgXCJtb3ZcImApO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgZXhlY1N5bmMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTtcbiAgICAgICAgY29uc3QgZmZwcm9iZUNtZCA9IGBmZnByb2JlIC12IHF1aWV0IC1wcmludF9mb3JtYXQganNvbiAtc2hvd19zdHJlYW1zIC1zaG93X2Zvcm1hdGA7XG4gICAgICAgIGNvbnN0IHByb2JlID0gSlNPTi5wYXJzZShleGVjU3luYyhgJHtmZnByb2JlQ21kfSBcIiR7dGhpcy5wYXRofVwiYCwgeyBlbmNvZGluZzogJ3V0ZjgnIH0pKTtcbiAgICAgICAgY29uc3QgeyBiaXRfcmF0ZSwgaGVpZ2h0IH0gPSBwcm9iZS5zdHJlYW1zLmZpbmQocyA9PiBzW1wiY29kZWNfdHlwZVwiXSA9PSBcInZpZGVvXCIpO1xuICAgICAgICByZXR1cm4gW2JpdF9yYXRlLCBoZWlnaHRdO1xuICAgIH1cblxuXG4gICAgZXhpc3RzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gZnMuZXhpc3RzU3luYyh0aGlzLnBhdGgpO1xuICAgIH1cblxuXG4gICAgcmVtb3ZlKCk6IHZvaWQge1xuICAgICAgICBmcy51bmxpbmtTeW5jKHRoaXMucGF0aCk7XG4gICAgfVxuXG4gICAgc2l6ZSgpOiBudW1iZXIge1xuICAgICAgICBsZXQgeyBzaXplIH0gPSBmcy5sc3RhdFN5bmModGhpcy5wYXRoKTtcbiAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgVHJ1dGgge1xuICAgIC8qKlRoZSBhYnNvbHV0ZSBwYXRoIHdpdGhvdXQgZXh0ZW5zaW9uLiovXG4gICAgcGF0aE5vRXh0OiBzdHJpbmc7XG4gICAgLyoqVGhlIGJhc2VuYW1lIHdpdGhvdXQgZXh0ZW5zaW9uLiovXG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR4dDogVHh0O1xuICAgIC8qKkEgRmlsZSBvYmplY3Qgb2YgdGhlIG1pZGkgZmlsZS4qL1xuICAgIG1pZGk6IEZpbGU7XG4gICAgLyoqQSBGaWxlIG9iamVjdCBvZiB0aGUgbXA0IGZpbGUuKi9cbiAgICBtcDQ6IEZpbGU7XG4gICAgLyoqQSBGaWxlIG9iamVjdCBvZiB0aGUgbW92IGZpbGUuKi9cbiAgICBtb3Y6IEZpbGU7XG4gICAgLyoqQSBGaWxlIG9iamVjdCBvZiB0aGUgb25zZXRzIGZpbGUqL1xuICAgIG9uc2V0czogRmlsZTtcblxuICAgIC8qKkFuIG9iamVjdCB3cmFwcGluZyBhbiBhYnNvbHV0ZSBwYXRoIHdpdGhvdXQgZXh0ZW5zaW9uLiovXG4gICAgY29uc3RydWN0b3IocGF0aE5vRXh0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCFwYXRoLmlzQWJzb2x1dGUocGF0aE5vRXh0KSkge1xuICAgICAgICAgICAgYWxlcnQoYFBhc3NlZCBwYXRoIGlzIG5vdCBhYnNvbHV0ZTogJHtwYXRoTm9FeHR9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHV0aWwuYm9vbChwYXRoLmV4dG5hbWUocGF0aE5vRXh0KSkpIHtcbiAgICAgICAgICAgIGFsZXJ0KGBQYXNzZWQgcGF0aCBpcyBub3QgZXh0ZW5zaW9ubGVzczogJHtwYXRoTm9FeHR9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdGhOb0V4dC5lbmRzV2l0aCgnb2ZmJykgfHwgcGF0aE5vRXh0LmVuZHNXaXRoKCdvbicpKSB7XG4gICAgICAgICAgICBhbGVydChgUGFzc2VkIHBhdGggb2YgXCJfb25cIiBvciBcIl9vZmZcIiBmaWxlIGFuZCBub3QgYmFzZTogJHtwYXRoTm9FeHR9YCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBhdGhOb0V4dCA9IHBhdGhOb0V4dDtcbiAgICAgICAgdGhpcy5uYW1lID0gcGF0aC5iYXNlbmFtZSh0aGlzLnBhdGhOb0V4dCk7XG4gICAgICAgIHRoaXMudHh0ID0gbmV3IFR4dCh0aGlzLnBhdGhOb0V4dCk7XG5cbiAgICAgICAgdGhpcy5taWRpID0gbmV3IEZpbGUoYCR7dGhpcy5wYXRoTm9FeHR9Lm1pZGApO1xuICAgICAgICB0aGlzLm1wNCA9IG5ldyBGaWxlKGAke3RoaXMucGF0aE5vRXh0fS5tcDRgKTtcbiAgICAgICAgdGhpcy5tb3YgPSBuZXcgRmlsZShgJHt0aGlzLnBhdGhOb0V4dH0ubW92YCk7XG4gICAgICAgIHRoaXMub25zZXRzID0gbmV3IEZpbGUoYCR7dGhpcy5wYXRoTm9FeHR9X29uc2V0cy5qc29uYCk7XG5cbiAgICB9XG5cbiAgICAvKipDb3VudHMgdGhlIG51bWJlciBvZiBub24tZW1wdHkgbGluZXMgaW4gdGhlIHR4dCBvbiBwYXRoIGZpbGUuKi9cbiAgICBudW1PZk5vdGVzKCk6IG51bWJlciB7XG4gICAgICAgIGlmICghdGhpcy50eHQub24uZXhpc3RzKCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgdGhpcy50eHQub24gKCR7dGhpcy50eHQub24ucGF0aH0pIGRvZXMgbm90IGV4aXN0LCByZXR1cm5pbmcgdW5kZWZpbmVkYCk7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RyaW5ncyA9IGZzXG4gICAgICAgICAgICAucmVhZEZpbGVTeW5jKHRoaXMudHh0Lm9uLnBhdGgsIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KVxuICAgICAgICAgICAgLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgbGV0IG5vdGVzOiBudW1iZXIgPSAwO1xuICAgICAgICBmb3IgKGxldCBzIG9mIHN0cmluZ3MpIHtcbiAgICAgICAgICAgIGlmIChzLmluY2x1ZGVzKCdcXFxcJykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYHMgaW5jbHVkZXMgYmFja3NsYXNoLCAke3RoaXMudHh0Lm9ufWApO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1dGlsLmJvb2wocykpIHtcbiAgICAgICAgICAgICAgICBub3RlcysrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vdGVzO1xuICAgIH1cbn0iXX0=