"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.group(`renderer.js`);
const util = require("./src/util");
const bhe_1 = require("./bhe");
Object.defineProperty(Object.prototype, "keys", {
    enumerable: false,
    value() {
        return Object.keys(this).map(key => key.isdigit()
            ? parseInt(key) : key);
    }
});
Object.defineProperty(Array.prototype, "apply", {
    enumerable: false,
    *value(fn) {
        for (let x in this) {
            yield fn(x);
        }
    }
});
Object.defineProperty(Array.prototype, "last", {
    enumerable: false,
    value() {
        return this[this.length - 1];
    }
});
Object.defineProperty(Array.prototype, "lowerAll", {
    enumerable: false,
    value() {
        return this.map(s => s.lower());
    }
});
Object.defineProperty(Array.prototype, "rsort", {
    enumerable: false,
    value() {
        return this.sort((n, m) => n < m);
    }
});
Object.defineProperty(Array.prototype, "count", {
    enumerable: false,
    value(item, strict) {
        let _count = 0;
        if (util.isFunction(item)) {
            for (let x of this) {
                if (item(x)) {
                    _count++;
                }
            }
        }
        else {
            for (let x of this) {
                if (strict) {
                    if (x === item) {
                        _count++;
                    }
                }
                else if (x == item) {
                    _count++;
                }
            }
            return _count;
        }
    }
});
Object.defineProperty(String.prototype, "endsWithAny", {
    enumerable: false,
    value(...args) {
        for (let x of args) {
            if (this.endsWith(x)) {
                return true;
            }
        }
        return false;
    }
});
Object.defineProperty(String.prototype, "upTo", {
    enumerable: false,
    value(searchString, fromEnd = false) {
        let end = fromEnd
            ? this.lastIndexOf(searchString)
            : this.indexOf(searchString);
        if (end === -1) {
            console.warn(`${this.valueOf()}.upTo(${searchString},${fromEnd}) index is -1`);
        }
        return this.slice(0, end);
    }
});
Object.defineProperty(String.prototype, "in", {
    enumerable: false,
    value(arr) {
        return arr.includes(this.valueOf());
    }
});
Object.defineProperty(String.prototype, "lower", {
    enumerable: false,
    value() {
        return this.toLowerCase();
    }
});
Object.defineProperty(String.prototype, "upper", {
    enumerable: false,
    value() {
        return this.toUpperCase();
    }
});
Object.defineProperty(String.prototype, "title", {
    enumerable: false,
    value() {
        if (this.includes(' ')) {
            return this.split(' ').map(str => str.title()).join(' ');
        }
        else {
            if (this.match(/[_\-.]/)) {
                let temp = this.replaceAll(/[_\-.]/, ' ');
                return temp.title();
            }
            else {
                return this[0].upper() + this.slice(1, this.length).lower();
            }
        }
    }
});
Object.defineProperty(String.prototype, "isdigit", {
    enumerable: false,
    value() {
        return !isNaN(Math.floor(this));
    }
});
Object.defineProperty(String.prototype, "removeAll", {
    enumerable: false,
    value(removeValue, ...removeValues) {
        let temp = this;
        for (let value of [removeValue, ...removeValues]) {
            temp = temp.replaceAll(value, '');
        }
        return temp;
    }
});
Object.defineProperty(String.prototype, "replaceAll", {
    enumerable: false,
    value(searchValue, replaceValue) {
        const type = typeof searchValue;
        if (type === 'string' || type === 'number') {
            return this
                .split(searchValue)
                .join(replaceValue);
        }
        else if (type === 'object') {
            if (searchValue.compile()) {
                let temp = this;
                let replaced = temp.replace(searchValue, replaceValue);
                while (replaced !== temp) {
                    temp = replaced;
                    replaced = replaced.replace(searchValue, replaceValue);
                }
                return replaced;
            }
            else {
                let temp = this;
                for (let [sv, rv] of Object.entries(searchValue)) {
                    temp = temp.replaceAll(sv, rv);
                }
                return temp;
            }
        }
        else {
            console.warn(`replaceAll got a bad type, searchValue: ${searchValue}, type: ${type}`);
            return this;
        }
    }
});
Object.defineProperty(Number.prototype, "human", {
    enumerable: false,
    value(letters = false) {
        const floored = Math.floor(this);
        switch (floored) {
            case 0:
                return letters
                    ? "zeroth"
                    : "0th";
            case 1:
                return letters
                    ? "first"
                    : "1st";
            case 2:
                return letters
                    ? "second"
                    : "2nd";
            case 3:
                return letters
                    ? "third"
                    : "3rd";
            case 4:
                return letters
                    ? "fourth"
                    : "4th";
            case 5:
                return letters
                    ? "fifth"
                    : "5th";
            case 6:
                return letters
                    ? "sixth"
                    : "6th";
            case 7:
                return letters
                    ? "seventh"
                    : "7th";
            case 8:
                return letters
                    ? "eighth"
                    : "8th";
            case 9:
                return letters
                    ? "ninth"
                    : "9th";
            case 10:
                return letters
                    ? "tenth"
                    : "10th";
            case 11:
                return letters
                    ? "eleventh"
                    : "11th";
            case 12:
                return letters
                    ? "twelveth"
                    : "12th";
            case 13:
                return letters
                    ? "thirteenth"
                    : "13th";
            case 14:
                return letters
                    ? "fourteenth"
                    : "14th";
            case 15:
                return letters
                    ? "fifteenth"
                    : "15th";
            case 16:
                return letters
                    ? "sixteenth"
                    : "16th";
            case 17:
                return letters
                    ? "seventeenth"
                    : "17th";
            case 18:
                return letters
                    ? "eighteenth"
                    : "18th";
            case 19:
                return letters
                    ? "ninteenth"
                    : "19th";
            default:
                const stringed = floored.toString();
                const lastChar = stringed.slice(-1);
                let suffix;
                switch (lastChar) {
                    case "1":
                        suffix = "st";
                        break;
                    case "2":
                        suffix = "nd";
                        break;
                    case "3":
                        suffix = "rd";
                        break;
                    default:
                        suffix = "th";
                        break;
                }
                return `${floored}${suffix}`;
        }
    }
});
Object.defineProperty(Date.prototype, "human", {
    enumerable: false, value() {
        let d = this.getUTCDate();
        d = d < 10 ? `0${d}` : d;
        let m = this.getMonth() + 1;
        m = m < 10 ? `0${m}` : m;
        const y = this.getFullYear();
        const t = this.toTimeString().slice(0, 8).replaceAll(':', '-');
        return `${d}_${m}_${y}_${t}`;
    }
});
Object.defineProperty(Error.prototype, "toObj", {
    enumerable: false, value() {
        const where = this.stack.slice(this.stack.search(/(?<=\s)at/), this.stack.search(/(?<=at\s.*)\n/));
        const what = this.message;
        Error.captureStackTrace(this);
        const root_abs_path = store.get('root_abs_path', '');
        const cleanstack = this.stack.split('\n')
            .filter(s => s.includes(root_abs_path) && !s.includes('node_modules'))
            .map(s => {
            s = s.trim();
            let frame = s.slice(s.search(root_abs_path), s.length - 1);
            let [file, lineno, ...rest] = frame.split(':');
            file = path.relative(root_abs_path, file);
            return { file, lineno };
        });
        return { what, where, cleanstack };
    }
});
const path = require("path");
const Store = require("electron-store");
const store = new Store();
exports.$PageCss = $('#page_css');
exports.PageCss = bhe_1.div({ byid: 'page_css' });
exports.$Title = $('#title');
exports.Title = bhe_1.div({ byid: 'title' });
exports.$MainContent = $('#main');
exports.MainContent = bhe_1.div({ byid: 'main' });
console.log('renderer.js EOF');
console.groupEnd();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0IsbUNBQWtDO0FBQ2xDLCtCQUE0QjtBQWtENUIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRTtJQUM1QyxVQUFVLEVBQUUsS0FBSztJQUNqQixLQUFLO1FBRUQsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUU7WUFDN0MsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsQ0FBQztDQUNKLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUU7SUFDNUMsVUFBVSxFQUFFLEtBQUs7SUFDakIsQ0FBRSxLQUFLLENBQUMsRUFBRTtRQUNOLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFO1lBQ2hCLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2Y7SUFDTCxDQUFDO0NBQ0osQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRTtJQUMzQyxVQUFVLEVBQUUsS0FBSztJQUNqQixLQUFLO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNqQyxDQUFDO0NBQ0osQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRTtJQUMvQyxVQUFVLEVBQUUsS0FBSztJQUNqQixLQUFL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QUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO0FBQ3BDLFFBQUEsTUFBTSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNyQixRQUFBLEtBQUssR0FBRyxTQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUMvQixRQUFBLFlBQVksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDMUIsUUFBQSxXQUFXLEdBQUcsU0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQy9CLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRNYXAgfSBmcm9tIFwiLi9zcmMvdXRpbFwiO1xuXG5jb25zb2xlLmdyb3VwKGByZW5kZXJlci5qc2ApO1xuXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gXCIuL3NyYy91dGlsXCJcbmltcG9ydCB7IGRpdiB9IGZyb20gXCIuL2JoZVwiO1xuXG5cbmludGVyZmFjZSBTdHJpbmcge1xuICAgIGVuZHNXaXRoQW55KC4uLmFyZ3M6IHN0cmluZ1tdKTogYm9vbGVhblxuXG4gICAgaHVtYW4oKTogc3RyaW5nXG5cbiAgICBpc2RpZ2l0KCk6IGJvb2xlYW5cblxuICAgIGxvd2VyKCk6IHN0cmluZ1xuXG4gICAgdXBwZXIoKTogc3RyaW5nXG5cbiAgICByZW1vdmVBbGwocmVtb3ZlVmFsdWU6IHN0cmluZyB8IG51bWJlciB8IFJlZ0V4cCB8IFRNYXA8c3RyaW5nPiwgLi4ucmVtb3ZlVmFsdWVzOiAoc3RyaW5nIHwgbnVtYmVyIHwgUmVnRXhwIHwgVE1hcDxzdHJpbmc+KVtdKTogc3RyaW5nXG5cbiAgICByZXBsYWNlQWxsKHNlYXJjaFZhbHVlOiBUTWFwPHN0cmluZz4pOiBzdHJpbmdcblxuICAgIHJlcGxhY2VBbGwoc2VhcmNoVmFsdWU6IHN0cmluZyB8IG51bWJlciB8IFJlZ0V4cCwgcmVwbGFjZVZhbHVlOiBzdHJpbmcpOiBzdHJpbmdcblxuICAgIHRpdGxlKCk6IHN0cmluZ1xuXG4gICAgdXBUbyhzZWFyY2hTdHJpbmc6IHN0cmluZywgc2VhcmNoRnJvbUVuZD86IGJvb2xlYW4pOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIEFycmF5PFQ+IHtcbiAgICBfbG93ZXJBbGw6IFRbXTtcblxuICAgIC8qKkFsc28gY2FjaGVzIF9sb3dlckFsbCovXG4gICAgbG93ZXJBbGwoKTogVFtdXG5cbiAgICBjb3VudChpdGVtOiBUKTogbnVtYmVyXG5cbiAgICBjb3VudChwcmVkaWNhdGU6IChhcmc6IHN0cmluZykgPT4gVCk6IG51bWJlclxuXG4gICAgYXBwbHk8VD4oZm46IChhcmc6IHN0cmluZykgPT4gVCk6IEdlbmVyYXRvcjxULCB2b2lkPlxufVxuXG5pbnRlcmZhY2UgTnVtYmVyIHtcbiAgICBodW1hbihsZXR0ZXJzPzogYm9vbGVhbik6IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgRXJyb3Ige1xuICAgIHRvT2JqKCk6IHsgd2hhdDogc3RyaW5nLCB3aGVyZTogc3RyaW5nLCBjbGVhbnN0YWNrOiB7IGZpbGU6IHN0cmluZywgbGluZW5vOiBzdHJpbmcgfVtdIH1cbn1cblxuaW50ZXJmYWNlIERhdGUge1xuICAgIGh1bWFuKCk6IHN0cmluZ1xufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LnByb3RvdHlwZSwgXCJrZXlzXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcykubWFwKGtleSA9PiBrZXkuaXNkaWdpdCgpXG4gICAgICAgICAgICA/IHBhcnNlSW50KGtleSkgOiBrZXkpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgXCJhcHBseVwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgKiB2YWx1ZShmbikge1xuICAgICAgICBmb3IgKGxldCB4IGluIHRoaXMpIHtcbiAgICAgICAgICAgIHlpZWxkIGZuKHgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCBcImxhc3RcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgXCJsb3dlckFsbFwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1hcChzID0+IHMubG93ZXIoKSk7XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXkucHJvdG90eXBlLCBcInJzb3J0XCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydCgobiwgbSkgPT4gbiA8IG0pO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgXCJjb3VudFwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoaXRlbSwgc3RyaWN0KSB7XG4gICAgICAgIGxldCBfY291bnQgPSAwO1xuICAgICAgICBpZiAodXRpbC5pc0Z1bmN0aW9uKGl0ZW0pKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4IG9mIHRoaXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSh4KSkge1xuICAgICAgICAgICAgICAgICAgICBfY291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCB4IG9mIHRoaXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RyaWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4ID09PSBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeCA9PSBpdGVtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgX2NvdW50Kys7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX2NvdW50O1xuICAgICAgICB9XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJlbmRzV2l0aEFueVwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoLi4uYXJncykge1xuICAgICAgICBmb3IgKGxldCB4IG9mIGFyZ3MpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVuZHNXaXRoKHgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwidXBUb1wiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoc2VhcmNoU3RyaW5nLCBmcm9tRW5kID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IGVuZCA9IGZyb21FbmRcbiAgICAgICAgICAgID8gdGhpcy5sYXN0SW5kZXhPZihzZWFyY2hTdHJpbmcpXG4gICAgICAgICAgICA6IHRoaXMuaW5kZXhPZihzZWFyY2hTdHJpbmcpO1xuICAgICAgICBpZiAoZW5kID09PSAtMSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGAke3RoaXMudmFsdWVPZigpfS51cFRvKCR7c2VhcmNoU3RyaW5nfSwke2Zyb21FbmR9KSBpbmRleCBpcyAtMWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnNsaWNlKDAsIGVuZCk7XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJpblwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoYXJyKSB7XG4gICAgICAgIHJldHVybiBhcnIuaW5jbHVkZXModGhpcy52YWx1ZU9mKCkpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwibG93ZXJcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwidXBwZXJcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b1VwcGVyQ2FzZSgpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwidGl0bGVcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICBpZiAodGhpcy5pbmNsdWRlcygnICcpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zcGxpdCgnICcpLm1hcChzdHIgPT4gc3RyLnRpdGxlKCkpLmpvaW4oJyAnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKC9bX1xcLS5dLykpIHtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IHRoaXMucmVwbGFjZUFsbCgvW19cXC0uXS8sICcgJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRlbXAudGl0bGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbMF0udXBwZXIoKSArIHRoaXMuc2xpY2UoMSwgdGhpcy5sZW5ndGgpLmxvd2VyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcImlzZGlnaXRcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gIWlzTmFOKE1hdGguZmxvb3IodGhpcykpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwicmVtb3ZlQWxsXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZShyZW1vdmVWYWx1ZSwgLi4ucmVtb3ZlVmFsdWVzKSB7XG4gICAgICAgIGxldCB0ZW1wID0gdGhpcztcbiAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgW3JlbW92ZVZhbHVlLCAuLi5yZW1vdmVWYWx1ZXNdKSB7XG4gICAgICAgICAgICB0ZW1wID0gdGVtcC5yZXBsYWNlQWxsKHZhbHVlLCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRlbXA7XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJyZXBsYWNlQWxsXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZShzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2Ygc2VhcmNoVmFsdWU7XG4gICAgICAgIGlmICh0eXBlID09PSAnc3RyaW5nJyB8fCB0eXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgICAgICAuc3BsaXQoc2VhcmNoVmFsdWUpXG4gICAgICAgICAgICAgICAgLmpvaW4ocmVwbGFjZVZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgaWYgKHNlYXJjaFZhbHVlLmNvbXBpbGUoKSkge1xuICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gdGhpcztcbiAgICAgICAgICAgICAgICBsZXQgcmVwbGFjZWQgPSB0ZW1wLnJlcGxhY2Uoc2VhcmNoVmFsdWUsIHJlcGxhY2VWYWx1ZSk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHJlcGxhY2VkICE9PSB0ZW1wKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXAgPSByZXBsYWNlZDtcbiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZWQgPSByZXBsYWNlZC5yZXBsYWNlKHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVwbGFjZWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gdGhpcztcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBbc3YsIHJ2XSBvZiBPYmplY3QuZW50cmllcyhzZWFyY2hWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHRlbXAucmVwbGFjZUFsbChzdiwgcnYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgcmVwbGFjZUFsbCBnb3QgYSBiYWQgdHlwZSwgc2VhcmNoVmFsdWU6ICR7c2VhcmNoVmFsdWV9LCB0eXBlOiAke3R5cGV9YCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KE51bWJlci5wcm90b3R5cGUsIFwiaHVtYW5cIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKGxldHRlcnMgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCBmbG9vcmVkID0gTWF0aC5mbG9vcih0aGlzKTtcbiAgICAgICAgc3dpdGNoIChmbG9vcmVkKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInplcm90aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIwdGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZmlyc3RcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMXN0XCI7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInNlY29uZFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIybmRcIjtcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwidGhpcmRcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiM3JkXCI7XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZvdXJ0aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI0dGhcIjtcbiAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZmlmdGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiNXRoXCI7XG4gICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInNpeHRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjZ0aFwiO1xuICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzZXZlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjd0aFwiO1xuICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJlaWdodGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiOHRoXCI7XG4gICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcIm5pbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjl0aFwiO1xuICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwidGVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTB0aFwiO1xuICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZWxldmVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTF0aFwiO1xuICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwidHdlbHZldGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTJ0aFwiO1xuICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwidGhpcnRlZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIxM3RoXCI7XG4gICAgICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJmb3VydGVlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjE0dGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZpZnRlZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIxNXRoXCI7XG4gICAgICAgICAgICBjYXNlIDE2OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzaXh0ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTZ0aFwiO1xuICAgICAgICAgICAgY2FzZSAxNzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwic2V2ZW50ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTd0aFwiO1xuICAgICAgICAgICAgY2FzZSAxODpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZWlnaHRlZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIxOHRoXCI7XG4gICAgICAgICAgICBjYXNlIDE5OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJuaW50ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTl0aFwiO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zdCBzdHJpbmdlZCA9IGZsb29yZWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0Q2hhciA9IHN0cmluZ2VkLnNsaWNlKC0xKTtcbiAgICAgICAgICAgICAgICBsZXQgc3VmZml4O1xuICAgICAgICAgICAgICAgIHN3aXRjaCAobGFzdENoYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIjFcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeCA9IFwic3RcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiMlwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgc3VmZml4ID0gXCJuZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCIzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWZmaXggPSBcInJkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeCA9IFwidGhcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7Zmxvb3JlZH0ke3N1ZmZpeH1gO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0ZS5wcm90b3R5cGUsIFwiaHVtYW5cIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLCB2YWx1ZSgpIHtcbiAgICAgICAgbGV0IGQgPSB0aGlzLmdldFVUQ0RhdGUoKTtcbiAgICAgICAgZCA9IGQgPCAxMCA/IGAwJHtkfWAgOiBkO1xuICAgICAgICBsZXQgbSA9IHRoaXMuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIG0gPSBtIDwgMTAgPyBgMCR7bX1gIDogbTtcbiAgICAgICAgY29uc3QgeSA9IHRoaXMuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgOCkucmVwbGFjZUFsbCgnOicsICctJyk7XG4gICAgICAgIHJldHVybiBgJHtkfV8ke219XyR7eX1fJHt0fWA7XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoRXJyb3IucHJvdG90eXBlLCBcInRvT2JqXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSwgdmFsdWUoKSB7XG4gICAgICAgIGNvbnN0IHdoZXJlID0gdGhpcy5zdGFjay5zbGljZSh0aGlzLnN0YWNrLnNlYXJjaCgvKD88PVxccylhdC8pLCB0aGlzLnN0YWNrLnNlYXJjaCgvKD88PWF0XFxzLiopXFxuLykpO1xuICAgICAgICBjb25zdCB3aGF0ID0gdGhpcy5tZXNzYWdlO1xuICAgICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzKTtcbiAgICAgICAgY29uc3Qgcm9vdF9hYnNfcGF0aCA9IHN0b3JlLmdldCgncm9vdF9hYnNfcGF0aCcsICcnKTtcbiAgICAgICAgY29uc3QgY2xlYW5zdGFjayA9IHRoaXMuc3RhY2suc3BsaXQoJ1xcbicpXG4gICAgICAgICAgICAuZmlsdGVyKHMgPT4gcy5pbmNsdWRlcyhyb290X2Fic19wYXRoKSAmJiAhcy5pbmNsdWRlcygnbm9kZV9tb2R1bGVzJykpXG4gICAgICAgICAgICAubWFwKHMgPT4ge1xuICAgICAgICAgICAgICAgIHMgPSBzLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBsZXQgZnJhbWUgPSBzLnNsaWNlKHMuc2VhcmNoKHJvb3RfYWJzX3BhdGgpLCBzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgIGxldCBbZmlsZSwgbGluZW5vLCAuLi5yZXN0XSA9IGZyYW1lLnNwbGl0KCc6Jyk7XG4gICAgICAgICAgICAgICAgZmlsZSA9IHBhdGgucmVsYXRpdmUocm9vdF9hYnNfcGF0aCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgZmlsZSwgbGluZW5vIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHsgd2hhdCwgd2hlcmUsIGNsZWFuc3RhY2sgfTtcbiAgICB9XG59KTtcbi8vICoqKiBmdW5jdGlvbnNcbi8vIGNvbnN0IHtBbGVydH0gPSByZXF1aXJlKCdweWFub19sb2NhbF9tb2R1bGVzL3V0aWwvQWxlcnQnKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbi8vIGNvbnN0ICQgPSByZXF1aXJlKFwianF1ZXJ5XCIpO1xuY29uc3QgU3RvcmUgPSByZXF1aXJlKFwiZWxlY3Ryb24tc3RvcmVcIik7XG5jb25zdCBzdG9yZSA9IG5ldyBTdG9yZSgpO1xuXG4vLyBza2lwRmFkZSA9IGZhbHNlO1xuXG4vKk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCQucHJvdG90eXBlLCB7XG4gICAgZmFkZToge1xuICAgICAgICBhc3luYyB2YWx1ZShzcGVlZCwgdG8sIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBsZXQgc2tpcEZhZGUgPSBzdG9yZS5nZXQoJ3NraXBGYWRlJywgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHNraXBGYWRlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dvdCBza2lwRmFkZSA9IHRydWUgc3RhcnQgb2YgZm4sIHJldHVybmluZycpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZhZGVUbygwLCB0bywgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXNbMF07XG4gICAgICAgICAgICBpZiAoZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gXCJidXR0b25cIikge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgndW5jbGlja2FibGUnLCB0byA9PSAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBwcmV2T3BhYyA9IGVsZW1lbnQuc3R5bGUub3BhY2l0eTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcHJldk9wYWMgIT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICBwcmV2T3BhYyA9IHRvID8gMCA6IDE7IC8vIG9wcG9zaXRlXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gcHJldk9wYWM7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBNYXRoLmFicyhwcmV2T3BhYyAtIHRvKTtcbiAgICAgICAgICAgIGxldCBzdGVwO1xuICAgICAgICAgICAgaWYgKHRvKSB7XG4gICAgICAgICAgICAgICAgc3RlcCA9IGRpZmYgLyAzMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3RlcCA9IC1kaWZmIC8gMzI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBldmVyeU1zID0gdXRpbC5yb3VuZChzcGVlZCAvIDMyKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgb2YgdXRpbC5yYW5nZSgwLCAzMSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2tpcEZhZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dvdCBza2lwRmFkZSA9IHRydWUgaW4gbG9vcCwgcmV0dXJuaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZhZGVUbygwLCB0bywgY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSBwYXJzZUZsb2F0KGVsZW1lbnQuc3R5bGUub3BhY2l0eSkgKyBzdGVwO1xuICAgICAgICAgICAgICAgIGF3YWl0IGFzeC53YWl0KGV2ZXJ5TXMpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhZGVUbygwLCB0bywgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBkZWFjdGl2YXRlOiB7XG4gICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVDbGFzcygnaW5hY3RpdmUtYnRuJywgdHJ1ZSlcbiAgICAgICAgICAgICAgICAudG9nZ2xlQ2xhc3MoJ2FjdGl2ZS1idG4nLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGFjdGl2YXRlOiB7XG4gICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVDbGFzcygnaW5hY3RpdmUtYnRuJywgZmFsc2UpXG4gICAgICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKCdhY3RpdmUtYnRuJywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHRvZ2dsZToge1xuICAgICAgICB2YWx1ZShhY3RpdmF0ZSkge1xuICAgICAgICAgICAgYWN0aXZhdGUgPyB0aGlzLmFjdGl2YXRlKCkgOiB0aGlzLmRlYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaXNBY3RpdmU6IHtcbiAgICAgICAgdmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYXNDbGFzcygnYWN0aXZlLWJ0bicpO1xuICAgICAgICB9XG4gICAgfSxcbn0pOyovXG5cblxuLy8gKioqIGZzeFxuLypjb25zdCBmc3ggPSAoKCkgPT4ge1xuICAgIGNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xuICAgIC8hKipAcGFyYW0ge1BhdGhMaWtlfHN0cmluZ30gcGF0aExpa2VcbiAgICAgKiBAcGFyYW0ge3ttb2RlPzpudW1iZXIsIHJlY3Vyc2l2ZT86Ym9vbGVhbn19IG9wdGlvbnNcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSohL1xuICAgIGNvbnN0IG1rZGlyID0gKHBhdGhMaWtlLCBvcHRpb25zKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+XG4gICAgICAgIGZzLm1rZGlyKHBhdGhMaWtlLCBvcHRpb25zLCBlcnIgPT4gcmVzb2x2ZSghdXRpbC5ib29sKGVycikpKSk7XG5cblxuICAgIC8hKipAcGFyYW0ge1BhdGhMaWtlfHN0cmluZ30gcGF0aExpa2VcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPGJvb2xlYW4+fSohL1xuICAgIGZ1bmN0aW9uIHBhdGhfZXhpc3RzKHBhdGhMaWtlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+XG4gICAgICAgICAgICBmcy5hY2Nlc3MocGF0aExpa2UsIGZzLmNvbnN0YW50cy5GX09LLCBlcnIgPT4gcmVzb2x2ZSghdXRpbC5ib29sKGVycikpKSk7XG4gICAgfVxuXG4gICAgLyEqKlxuICAgICB7QGxpbmsgcmVtb3ZlX2V4dCBVc2VzIHJlbW92ZV9leHR9XG4gICAgIEBwYXJhbSB7UGF0aExpa2V8c3RyaW5nfSBwYXRoTGlrZVxuICAgICBAcGFyYW0ge3N0cmluZ30gZXh0IC0gVGFyZ2V0IGV4dGVuc2lvbiB3aXRob3V0IGRvdFxuICAgICBAcmV0dXJuIHtzdHJpbmd9KiEvXG4gICAgY29uc3QgcmVwbGFjZV9leHQgPSAocGF0aExpa2UsIGV4dCkgPT4ge1xuICAgICAgICBpZiAoZXh0LmluY2x1ZGVzKCcuJykpIHtcbiAgICAgICAgICAgIGFsZXJ0KGBleHQgaW5jbHVkZWQgZG90IFwiLlwiLCBleHQ6ICR7ZXh0fWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtyZW1vdmVfZXh0KHBhdGhMaWtlKX0uJHtleHR9YDtcbiAgICB9O1xuXG4gICAgLyEqKlxuICAgICAqIEBwYXJhbSB7UGF0aExpa2V8c3RyaW5nfSBwYXRoTGlrZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHJlbW92ZV9leHQoXCJleHBlcmltZW50cy90cnV0aHMvZnVyX2VsaXNlX0IudHh0XCIpXG4gICAgICogPj4+IGV4cGVyaW1lbnRzL3RydXRocy9mdXJfZWxpc2VfQlxuICAgICAqIHJlbW92ZV9leHQoXCJmdXJfZWxpc2VfQi50eHRcIilcbiAgICAgKiA+Pj4gZnVyX2VsaXNlX0IgKiEvXG4gICAgY29uc3QgcmVtb3ZlX2V4dCA9IHBhdGhMaWtlID0+IHBhdGguam9pbihwYXRoLmRpcm5hbWUocGF0aExpa2UpLCBwYXRoLmJhc2VuYW1lKHBhdGhMaWtlLCBwYXRoLmV4dG5hbWUocGF0aExpa2UpKSk7XG5cbiAgICAvISoqXG4gICAgICoge0BsaW5rIHJlbW92ZV9leHQgVXNlcyByZW1vdmVfZXh0fVxuICAgICAqIEBwYXJhbSB7UGF0aExpa2V8c3RyaW5nfSBwYXRoTGlrZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcHVzaFxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKiAqIS9cbiAgICBjb25zdCBwdXNoX2JlZm9yZV9leHQgPSAocGF0aExpa2UsIHB1c2gpID0+IHtcbiAgICAgICAgbGV0IGV4dCA9IHBhdGguZXh0bmFtZShwYXRoTGlrZSk7XG4gICAgICAgIHJldHVybiBgJHtyZW1vdmVfZXh0KHBhdGhMaWtlKX0ke3B1c2h9JHtleHR9YDtcbiAgICB9O1xuXG4gICAgLyEqKkBwYXJhbSB7c3RyaW5nfFBhdGhMaWtlfSBwYXRoTGlrZVxuICAgICAqIEBwYXJhbSB7P3N0cmluZ30gZXh0KiEvXG4gICAgZnVuY3Rpb24gYmFzZW5hbWUocGF0aExpa2UsIGV4dCA9IG51bGwpIHtcbiAgICAgICAgaWYgKCFleHQpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXRoLmJhc2VuYW1lKHBhdGhMaWtlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGF0aC5iYXNlbmFtZShwYXRoTGlrZSwgZXh0KTtcbiAgICB9XG5cbiAgICAvISoqQHBhcmFtIHsuLi5zdHJpbmd9IHBhdGhzXG4gICAgICogQHJldHVybiB7c3RyaW5nW119XG4gICAgICogKiEvXG4gICAgZnVuY3Rpb24gYmFzZW5hbWVzKC4uLnBhdGhzKSB7XG4gICAgICAgIHJldHVybiBbLi4ucGF0aHMubWFwKHAgPT4gcGF0aC5iYXNlbmFtZShwKSldO1xuICAgIH1cblxuICAgIC8hKipAcGFyYW0ge3N0cmluZ30gcGF0aExpa2VcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9KiEvXG4gICAgZnVuY3Rpb24gZGlybmFtZShwYXRoTGlrZSkge1xuICAgICAgICByZXR1cm4gcGF0aC5kaXJuYW1lKHBhdGhMaWtlKTtcbiAgICB9XG5cbiAgICAvISoqQHBhcmFtIHtzdHJpbmd9IHBhdGhMaWtlXG4gICAgICogQHJldHVybiB7c3RyaW5nfSohL1xuICAgIGZ1bmN0aW9uIGV4dG5hbWUocGF0aExpa2UpIHtcbiAgICAgICAgcmV0dXJuIHBhdGguZXh0bmFtZShwYXRoTGlrZSk7XG4gICAgfVxuXG4gICAgLyEqKkBwYXJhbSB7c3RyaW5nfSBwYXRoTGlrZSohL1xuICAgIGZ1bmN0aW9uIHJlbW92ZShwYXRoTGlrZSkge1xuICAgICAgICBmcy51bmxpbmtTeW5jKHBhdGhMaWtlKTtcbiAgICB9XG5cbiAgICAvISoqIEB0eXBlIHt7XG4gICAgICogYmFzZW5hbWU6KGZ1bmN0aW9uKHN0cmluZ3xQYXRoTGlrZSw/c3RyaW5nKTpzdHJpbmcpLFxuICAgICAqIGJhc2VuYW1lczooZnVuY3Rpb24oLi4uc3RyaW5nfFBhdGhMaWtlKTpzdHJpbmdbXSksXG4gICAgICogZGlybmFtZTooZnVuY3Rpb24oLi4uc3RyaW5nfFBhdGhMaWtlKTpzdHJpbmcpLFxuICAgICAqIGV4dG5hbWU6KGZ1bmN0aW9uKC4uLnN0cmluZ3xQYXRoTGlrZSk6c3RyaW5nKSxcbiAgICAgKiBta2RpcjogKGZ1bmN0aW9uKChQYXRoTGlrZXxzdHJpbmcpLCAobnVtYmVyfHN0cmluZ3xNYWtlRGlyZWN0b3J5T3B0aW9uc3x1bmRlZmluZWR8bnVsbCkpOiBQcm9taXNlPGJvb2xlYW4+KSxcbiAgICAgKiBwYXRoX2V4aXN0czogKGZ1bmN0aW9uKChQYXRoTGlrZXxzdHJpbmcpKTogUHJvbWlzZTxib29sZWFuPiksXG4gICAgICogcHVzaF9iZWZvcmVfZXh0OiAoZnVuY3Rpb24oKFBhdGhMaWtlfHN0cmluZyksIChzdHJpbmd8bnVtYmVyKSk6IHN0cmluZyksXG4gICAgICogcmVtb3ZlX2V4dDogKGZ1bmN0aW9uKChQYXRoTGlrZXxzdHJpbmcpKTogc3RyaW5nKSxcbiAgICAgKiByZXBsYWNlX2V4dDogKGZ1bmN0aW9uKChQYXRoTGlrZXxzdHJpbmcpLCBzdHJpbmcpOiBzdHJpbmcpfX1cbiAgICAgKiAqIS9cbiAgICByZXR1cm4geyBiYXNlbmFtZXMsIGJhc2VuYW1lLCBkaXJuYW1lLCBleHRuYW1lLCBta2RpciwgcGF0aF9leGlzdHMsIHJlcGxhY2VfZXh0LCByZW1vdmVfZXh0LCByZW1vdmUsIHB1c2hfYmVmb3JlX2V4dCB9O1xufSkoKTtcbmNvbnN0IGFzeCA9ICgoKSA9PiB7XG4gICAgLyEqKkBwYXJhbSB7bnVtYmVyfSBtc1xuICAgICAqIEByZXR1cm4ge1Byb21pc2V9KiEvXG4gICAgYXN5bmMgZnVuY3Rpb24gd2FpdChtcykge1xuXG4gICAgICAgIGlmIChzdG9yZS5nZXQoJ3NraXBGYWRlJywgZmFsc2UpKSB7XG4gICAgICAgICAgICBtcyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICAgIH1cblxuICAgIC8hKipAcGFyYW0ge2pRdWVyeX0galF1ZXJ5XG4gICAgIEBwYXJhbSB7bnVtYmVyfSBtc1xuICAgICBAcmV0dXJuIHtQcm9taXNlPGpRdWVyeT59KiEvXG4gICAgY29uc3QgJGZhZGVPdXQgPSAoalF1ZXJ5LCBtcykgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBqUXVlcnkuZmFkZShtcywgMCwgcmVzb2x2ZSkpO1xuXG4gICAgLyEqKkBwYXJhbSB7alF1ZXJ5fSBqUXVlcnlcbiAgICAgQHBhcmFtIHtudW1iZXJ9IG1zXG4gICAgIEByZXV0cm4ge1Byb21pc2U8alF1ZXJ5Pn0qIS9cbiAgICBjb25zdCAkZmFkZUluID0gKGpRdWVyeSwgbXMpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4galF1ZXJ5LmZhZGUobXMsIDEsIHJlc29sdmUpKTtcblxuICAgIC8hKipAcGFyYW0ge251bWJlcn0gbXNcbiAgICAgQHBhcmFtIHsuLi5qUXVlcnl9IGpRdWVyaWVzXG4gICAgIEByZXR1cm4ge1Byb21pc2U8alF1ZXJ5W10+fSohL1xuICAgIGFzeW5jIGZ1bmN0aW9uICRmYWRlSW5NYW55KG1zLCAuLi5qUXVlcmllcykge1xuICAgICAgICBsZXQgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgalEgb2YgalF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2goJGZhZGVJbihqUSwgbXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgfVxuXG4gICAgLyEqKkBwYXJhbSB7bnVtYmVyfSBtc1xuICAgICBAcGFyYW0gey4uLmpRdWVyeX0galF1ZXJpZXNcbiAgICAgQHJldHVybiB7UHJvbWlzZTxqUXVlcnlbXT59KiEvXG4gICAgYXN5bmMgZnVuY3Rpb24gJGZhZGVPdXRNYW55KG1zLCAuLi5qUXVlcmllcykge1xuICAgICAgICBsZXQgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgalEgb2YgalF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2goJGZhZGVPdXQoalEsIG1zKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgIH1cblxuXG4gICAgYXN5bmMgZnVuY3Rpb24gY29uY3VycmVudCguLi5wcm9taXNlcykge1xuICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgIH1cblxuICAgIC8hKipAdGVtcGxhdGUgVFxuICAgICAqIEBwYXJhbSB7Li4uZnVuY3Rpb24oKTpQcm9taXNlPFQ+fFR8dm9pZH0gZm5zXG4gICAgICogQHJldHVybiB7UHJvbWlzZTxUW10+fSohL1xuICAgIGFzeW5jIGZ1bmN0aW9uIHdhdGVyZmFsbCguLi5mbnMpIHtcbiAgICAgICAgZm9yIChsZXQgZm4gb2YgZm5zKSB7XG4gICAgICAgICAgICBhd2FpdCBmbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyEqKkB0eXBlIHtcbiAgICAgKiAgICAge1xuICAgICAqICAgICAgICAgJGZhZGVJbjogKGZ1bmN0aW9uKGpRdWVyeSwgbnVtYmVyKTogUHJvbWlzZTxqUXVlcnk+KSxcbiAgICAgKiAgICAgICAgICRmYWRlSW5NYW55OiAoZnVuY3Rpb24obnVtYmVyLCAuLi5qUXVlcnkpOiBqUXVlcnlbXSksXG4gICAgICogICAgICAgICAkZmFkZU91dDogKGZ1bmN0aW9uKGpRdWVyeSwgbnVtYmVyKTogUHJvbWlzZTxqUXVlcnk+KSxcbiAgICAgKiAgICAgICAgICRmYWRlT3V0TWFueTogKGZ1bmN0aW9uKG51bWJlciwgLi4ualF1ZXJ5KTogalF1ZXJ5W10pLFxuICAgICAqICAgICAgICAgY29uY3VycmVudDogKGZ1bmN0aW9uKC4uLmZ1bmN0aW9uKCk6IFQpOiBUW10pXG4gICAgICogICAgICAgICB3YWl0OiAoZnVuY3Rpb24obnVtYmVyKTogUHJvbWlzZTwqPiksXG4gICAgICogICAgIH1cbiAgICAgKiB9XG4gICAgICogQHRlbXBsYXRlIFQqIS9cbiAgICBjb25zdCBuZXdWYXIgPSB7XG4gICAgICAgICRmYWRlSW4sXG4gICAgICAgICRmYWRlT3V0LFxuICAgICAgICAkZmFkZU91dE1hbnksXG4gICAgICAgICRmYWRlSW5NYW55LFxuICAgICAgICBjb25jdXJyZW50LFxuICAgICAgICB3YWl0LFxuICAgICAgICB3YXRlcmZhbGwsXG4gICAgfTtcbiAgICByZXR1cm4gbmV3VmFyO1xufSkoKTsqL1xuXG5leHBvcnQgY29uc3QgJFBhZ2VDc3MgPSAkKCcjcGFnZV9jc3MnKTtcbmV4cG9ydCBjb25zdCBQYWdlQ3NzID0gZGl2KHsgYnlpZDogJ3BhZ2VfY3NzJyB9KTtcbmV4cG9ydCBjb25zdCAkVGl0bGUgPSAkKCcjdGl0bGUnKTtcbmV4cG9ydCBjb25zdCBUaXRsZSA9IGRpdih7IGJ5aWQ6ICd0aXRsZScgfSk7XG5leHBvcnQgY29uc3QgJE1haW5Db250ZW50ID0gJCgnI21haW4nKTtcbmV4cG9ydCBjb25zdCBNYWluQ29udGVudCA9IGRpdih7IGJ5aWQ6ICdtYWluJyB9KTtcbmNvbnNvbGUubG9nKCdyZW5kZXJlci5qcyBFT0YnKTtcbmNvbnNvbGUuZ3JvdXBFbmQoKTtcblxuIl19