"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.group(`renderer.js`);
const util = require("./src/util");
Object.defineProperty(Object.prototype, "keys", {
    enumerable: false,
    value() {
        return Object.keys(this).map(key => key.isdigit()
            ? parseInt(key) : key);
    }
});
Object.defineProperty(Array.prototype, "apply", {
    enumerable: false,
    *value(fn) {
        for (let x in this) {
            yield fn(x);
        }
    }
});
Object.defineProperty(Array.prototype, "last", {
    enumerable: false,
    value() {
        return this[this.length - 1];
    }
});
Object.defineProperty(Array.prototype, "lowerAll", {
    enumerable: false,
    value() {
        return this.map(s => s.lower());
    }
});
Object.defineProperty(Array.prototype, "rsort", {
    enumerable: false,
    value() {
        return this.sort((n, m) => n < m);
    }
});
Object.defineProperty(Array.prototype, "count", {
    enumerable: false,
    value(item, strict) {
        let _count = 0;
        if (util.isFunction(item)) {
            for (let x of this) {
                if (item(x)) {
                    _count++;
                }
            }
        }
        else {
            for (let x of this) {
                if (strict) {
                    if (x === item) {
                        _count++;
                    }
                }
                else if (x == item) {
                    _count++;
                }
            }
            return _count;
        }
    }
});
Object.defineProperty(String.prototype, "endsWithAny", {
    enumerable: false,
    value(...args) {
        for (let x of args) {
            if (this.endsWith(x)) {
                return true;
            }
        }
        return false;
    }
});
Object.defineProperty(String.prototype, "upTo", {
    enumerable: false,
    value(searchString, fromEnd = false) {
        let end = fromEnd
            ? this.lastIndexOf(searchString)
            : this.indexOf(searchString);
        if (end === -1) {
            console.warn(`${this.valueOf()}.upTo(${searchString},${fromEnd}) index is -1`);
        }
        return this.slice(0, end);
    }
});
Object.defineProperty(String.prototype, "in", {
    enumerable: false,
    value(arr) {
        return arr.includes(this.valueOf());
    }
});
Object.defineProperty(String.prototype, "lower", {
    enumerable: false,
    value() {
        return this.toLowerCase();
    }
});
Object.defineProperty(String.prototype, "upper", {
    enumerable: false,
    value() {
        return this.toUpperCase();
    }
});
Object.defineProperty(String.prototype, "title", {
    enumerable: false,
    value() {
        if (this.includes(' ')) {
            return this.split(' ').map(str => str.title()).join(' ');
        }
        else {
            if (this.match(/[_\-.]/)) {
                let temp = this.replaceAll(/[_\-.]/, ' ');
                return temp.title();
            }
            else {
                return this[0].upper() + this.slice(1, this.length).lower();
            }
        }
    }
});
Object.defineProperty(String.prototype, "isdigit", {
    enumerable: false,
    value() {
        return !isNaN(Math.floor(this));
    }
});
Object.defineProperty(String.prototype, "removeAll", {
    enumerable: false,
    value(removeValue, ...removeValues) {
        let temp = this;
        for (let value of [removeValue, ...removeValues]) {
            temp = temp.replaceAll(value, '');
        }
        return temp;
    }
});
Object.defineProperty(String.prototype, "replaceAll", {
    enumerable: false,
    value(searchValue, replaceValue) {
        const type = typeof searchValue;
        if (type === 'string' || type === 'number') {
            return this
                .split(searchValue)
                .join(replaceValue);
        }
        else if (type === 'object') {
            if (searchValue.compile()) {
                let temp = this;
                let replaced = temp.replace(searchValue, replaceValue);
                while (replaced !== temp) {
                    temp = replaced;
                    replaced = replaced.replace(searchValue, replaceValue);
                }
                return replaced;
            }
            else {
                let temp = this;
                for (let [sv, rv] of Object.entries(searchValue)) {
                    temp = temp.replaceAll(sv, rv);
                }
                return temp;
            }
        }
        else {
            console.warn(`replaceAll got a bad type, searchValue: ${searchValue}, type: ${type}`);
            return this;
        }
    }
});
Object.defineProperty(Number.prototype, "human", {
    enumerable: false,
    value(letters = false) {
        const floored = Math.floor(this);
        switch (floored) {
            case 0:
                return letters
                    ? "zeroth"
                    : "0th";
            case 1:
                return letters
                    ? "first"
                    : "1st";
            case 2:
                return letters
                    ? "second"
                    : "2nd";
            case 3:
                return letters
                    ? "third"
                    : "3rd";
            case 4:
                return letters
                    ? "fourth"
                    : "4th";
            case 5:
                return letters
                    ? "fifth"
                    : "5th";
            case 6:
                return letters
                    ? "sixth"
                    : "6th";
            case 7:
                return letters
                    ? "seventh"
                    : "7th";
            case 8:
                return letters
                    ? "eighth"
                    : "8th";
            case 9:
                return letters
                    ? "ninth"
                    : "9th";
            case 10:
                return letters
                    ? "tenth"
                    : "10th";
            case 11:
                return letters
                    ? "eleventh"
                    : "11th";
            case 12:
                return letters
                    ? "twelveth"
                    : "12th";
            case 13:
                return letters
                    ? "thirteenth"
                    : "13th";
            case 14:
                return letters
                    ? "fourteenth"
                    : "14th";
            case 15:
                return letters
                    ? "fifteenth"
                    : "15th";
            case 16:
                return letters
                    ? "sixteenth"
                    : "16th";
            case 17:
                return letters
                    ? "seventeenth"
                    : "17th";
            case 18:
                return letters
                    ? "eighteenth"
                    : "18th";
            case 19:
                return letters
                    ? "ninteenth"
                    : "19th";
            default:
                const stringed = floored.toString();
                const lastChar = stringed.slice(-1);
                let suffix;
                switch (lastChar) {
                    case "1":
                        suffix = "st";
                        break;
                    case "2":
                        suffix = "nd";
                        break;
                    case "3":
                        suffix = "rd";
                        break;
                    default:
                        suffix = "th";
                        break;
                }
                return `${floored}${suffix}`;
        }
    }
});
Object.defineProperty(Date.prototype, "human", {
    enumerable: false, value() {
        let d = this.getUTCDate();
        d = d < 10 ? `0${d}` : d;
        let m = this.getMonth() + 1;
        m = m < 10 ? `0${m}` : m;
        const y = this.getFullYear();
        const t = this.toTimeString().slice(0, 8).replaceAll(':', '-');
        return `${d}_${m}_${y}_${t}`;
    }
});
Object.defineProperty(Error.prototype, "toObj", {
    enumerable: false, value() {
        const where = this.stack.slice(this.stack.search(/(?<=\s)at/), this.stack.search(/(?<=at\s.*)\n/));
        const what = this.message;
        Error.captureStackTrace(this);
        const root_abs_path = store.get('root_abs_path', '');
        const cleanstack = this.stack.split('\n')
            .filter(s => s.includes(root_abs_path) && !s.includes('node_modules'))
            .map(s => {
            s = s.trim();
            let frame = s.slice(s.search(root_abs_path), s.length - 1);
            let [file, lineno, ...rest] = frame.split(':');
            file = path.relative(root_abs_path, file);
            return { file, lineno };
        });
        return { what, where, cleanstack };
    }
});
const path = require("path");
const Store = require("electron-store");
const store = new Store();
console.log('renderer.js EOF');
console.groupEnd();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFN0IsbUNBQWtDO0FBa0RsQyxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFO0lBQzVDLFVBQVUsRUFBRSxLQUFLO0lBQ2pCLEtBQUs7UUFFRCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRTtZQUM3QyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQixDQUFDO0NBQ0osQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRTtJQUM1QyxVQUFVLEVBQUUsS0FBSztJQUNqQixDQUFFLEtBQUssQ0FBQyxFQUFFO1FBQ04sS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLEVBQUU7WUFDaEIsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDZjtJQUNMLENBQUM7Q0FDSixDQUFDLENBQUM7QUFDSCxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFO0lBQzNDLFVBQVUsRUFBRSxLQUFLO0lBQ2pCLEtBQUs7UUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7Q0FDSixDQUFDLENBQUM7QUFDSCxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFO0lBQy9DLFVBQVUsRUFBRSxLQUFLO0lBQ2pCLEtBQUs7UUFDRCxPQUFPLElB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cG9ydCB7IFRNYXAgfSBmcm9tIFwiLi9zcmMvdXRpbFwiO1xuXG5jb25zb2xlLmdyb3VwKGByZW5kZXJlci5qc2ApO1xuXG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gXCIuL3NyYy91dGlsXCJcblxuXG5pbnRlcmZhY2UgU3RyaW5nIHtcbiAgICBlbmRzV2l0aEFueSguLi5hcmdzOiBzdHJpbmdbXSk6IGJvb2xlYW5cblxuICAgIGh1bWFuKCk6IHN0cmluZ1xuXG4gICAgaXNkaWdpdCgpOiBib29sZWFuXG5cbiAgICBsb3dlcigpOiBzdHJpbmdcblxuICAgIHVwcGVyKCk6IHN0cmluZ1xuXG4gICAgcmVtb3ZlQWxsKHJlbW92ZVZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBSZWdFeHAgfCBUTWFwPHN0cmluZz4sIC4uLnJlbW92ZVZhbHVlczogKHN0cmluZyB8IG51bWJlciB8IFJlZ0V4cCB8IFRNYXA8c3RyaW5nPilbXSk6IHN0cmluZ1xuXG4gICAgcmVwbGFjZUFsbChzZWFyY2hWYWx1ZTogVE1hcDxzdHJpbmc+KTogc3RyaW5nXG5cbiAgICByZXBsYWNlQWxsKHNlYXJjaFZhbHVlOiBzdHJpbmcgfCBudW1iZXIgfCBSZWdFeHAsIHJlcGxhY2VWYWx1ZTogc3RyaW5nKTogc3RyaW5nXG5cbiAgICB0aXRsZSgpOiBzdHJpbmdcblxuICAgIHVwVG8oc2VhcmNoU3RyaW5nOiBzdHJpbmcsIHNlYXJjaEZyb21FbmQ/OiBib29sZWFuKTogc3RyaW5nXG59XG5cbmludGVyZmFjZSBBcnJheTxUPiB7XG4gICAgX2xvd2VyQWxsOiBUW107XG5cbiAgICAvKipBbHNvIGNhY2hlcyBfbG93ZXJBbGwqL1xuICAgIGxvd2VyQWxsKCk6IFRbXVxuXG4gICAgY291bnQoaXRlbTogVCk6IG51bWJlclxuXG4gICAgY291bnQocHJlZGljYXRlOiAoYXJnOiBzdHJpbmcpID0+IFQpOiBudW1iZXJcblxuICAgIGFwcGx5PFQ+KGZuOiAoYXJnOiBzdHJpbmcpID0+IFQpOiBHZW5lcmF0b3I8VCwgdm9pZD5cbn1cblxuaW50ZXJmYWNlIE51bWJlciB7XG4gICAgaHVtYW4obGV0dGVycz86IGJvb2xlYW4pOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIEVycm9yIHtcbiAgICB0b09iaigpOiB7IHdoYXQ6IHN0cmluZywgd2hlcmU6IHN0cmluZywgY2xlYW5zdGFjazogeyBmaWxlOiBzdHJpbmcsIGxpbmVubzogc3RyaW5nIH1bXSB9XG59XG5cbmludGVyZmFjZSBEYXRlIHtcbiAgICBodW1hbigpOiBzdHJpbmdcbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KE9iamVjdC5wcm90b3R5cGUsIFwia2V5c1wiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMpLm1hcChrZXkgPT4ga2V5LmlzZGlnaXQoKVxuICAgICAgICAgICAgPyBwYXJzZUludChrZXkpIDoga2V5KTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwiYXBwbHlcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICogdmFsdWUoZm4pIHtcbiAgICAgICAgZm9yIChsZXQgeCBpbiB0aGlzKSB7XG4gICAgICAgICAgICB5aWVsZCBmbih4KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgXCJsYXN0XCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5sZW5ndGggLSAxXTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwibG93ZXJBbGxcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXAocyA9PiBzLmxvd2VyKCkpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwgXCJyc29ydFwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnQoKG4sIG0pID0+IG4gPCBtKTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwiY291bnRcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKGl0ZW0sIHN0cmljdCkge1xuICAgICAgICBsZXQgX2NvdW50ID0gMDtcbiAgICAgICAgaWYgKHV0aWwuaXNGdW5jdGlvbihpdGVtKSkge1xuICAgICAgICAgICAgZm9yIChsZXQgeCBvZiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0oeCkpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgeCBvZiB0aGlzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0cmljdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PT0gaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2NvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHggPT0gaXRlbSkge1xuXG4gICAgICAgICAgICAgICAgICAgIF9jb3VudCsrO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9jb3VudDtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwiZW5kc1dpdGhBbnlcIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKC4uLmFyZ3MpIHtcbiAgICAgICAgZm9yIChsZXQgeCBvZiBhcmdzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lbmRzV2l0aCh4KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInVwVG9cIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKHNlYXJjaFN0cmluZywgZnJvbUVuZCA9IGZhbHNlKSB7XG4gICAgICAgIGxldCBlbmQgPSBmcm9tRW5kXG4gICAgICAgICAgICA/IHRoaXMubGFzdEluZGV4T2Yoc2VhcmNoU3RyaW5nKVxuICAgICAgICAgICAgOiB0aGlzLmluZGV4T2Yoc2VhcmNoU3RyaW5nKTtcbiAgICAgICAgaWYgKGVuZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgJHt0aGlzLnZhbHVlT2YoKX0udXBUbygke3NlYXJjaFN0cmluZ30sJHtmcm9tRW5kfSkgaW5kZXggaXMgLTFgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zbGljZSgwLCBlbmQpO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwiaW5cIiwge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIHZhbHVlKGFycikge1xuICAgICAgICByZXR1cm4gYXJyLmluY2x1ZGVzKHRoaXMudmFsdWVPZigpKTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcImxvd2VyXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9Mb3dlckNhc2UoKTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInVwcGVyXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9VcHBlckNhc2UoKTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInRpdGxlXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5jbHVkZXMoJyAnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BsaXQoJyAnKS5tYXAoc3RyID0+IHN0ci50aXRsZSgpKS5qb2luKCcgJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgvW19cXC0uXS8pKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRlbXAgPSB0aGlzLnJlcGxhY2VBbGwoL1tfXFwtLl0vLCAnICcpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wLnRpdGxlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzWzBdLnVwcGVyKCkgKyB0aGlzLnNsaWNlKDEsIHRoaXMubGVuZ3RoKS5sb3dlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJpc2RpZ2l0XCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuICFpc05hTihNYXRoLmZsb29yKHRoaXMpKTtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInJlbW92ZUFsbFwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUocmVtb3ZlVmFsdWUsIC4uLnJlbW92ZVZhbHVlcykge1xuICAgICAgICBsZXQgdGVtcCA9IHRoaXM7XG4gICAgICAgIGZvciAobGV0IHZhbHVlIG9mIFtyZW1vdmVWYWx1ZSwgLi4ucmVtb3ZlVmFsdWVzXSkge1xuICAgICAgICAgICAgdGVtcCA9IHRlbXAucmVwbGFjZUFsbCh2YWx1ZSwgJycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0ZW1wO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwicmVwbGFjZUFsbFwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgdmFsdWUoc2VhcmNoVmFsdWUsIHJlcGxhY2VWYWx1ZSkge1xuICAgICAgICBjb25zdCB0eXBlID0gdHlwZW9mIHNlYXJjaFZhbHVlO1xuICAgICAgICBpZiAodHlwZSA9PT0gJ3N0cmluZycgfHwgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzXG4gICAgICAgICAgICAgICAgLnNwbGl0KHNlYXJjaFZhbHVlKVxuICAgICAgICAgICAgICAgIC5qb2luKHJlcGxhY2VWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGlmIChzZWFyY2hWYWx1ZS5jb21waWxlKCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgbGV0IHJlcGxhY2VkID0gdGVtcC5yZXBsYWNlKHNlYXJjaFZhbHVlLCByZXBsYWNlVmFsdWUpO1xuICAgICAgICAgICAgICAgIHdoaWxlIChyZXBsYWNlZCAhPT0gdGVtcCkge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wID0gcmVwbGFjZWQ7XG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2VkID0gcmVwbGFjZWQucmVwbGFjZShzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcGxhY2VkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgW3N2LCBydl0gb2YgT2JqZWN0LmVudHJpZXMoc2VhcmNoVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXAgPSB0ZW1wLnJlcGxhY2VBbGwoc3YsIHJ2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRlbXA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYHJlcGxhY2VBbGwgZ290IGEgYmFkIHR5cGUsIHNlYXJjaFZhbHVlOiAke3NlYXJjaFZhbHVlfSwgdHlwZTogJHt0eXBlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShOdW1iZXIucHJvdG90eXBlLCBcImh1bWFuXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICB2YWx1ZShsZXR0ZXJzID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgZmxvb3JlZCA9IE1hdGguZmxvb3IodGhpcyk7XG4gICAgICAgIHN3aXRjaCAoZmxvb3JlZCkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJ6ZXJvdGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMHRoXCI7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZpcnN0XCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjFzdFwiO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzZWNvbmRcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMm5kXCI7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInRoaXJkXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjNyZFwiO1xuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJmb3VydGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiNHRoXCI7XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZpZnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjV0aFwiO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzaXh0aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI2dGhcIjtcbiAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwic2V2ZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI3dGhcIjtcbiAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZWlnaHRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjh0aFwiO1xuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJuaW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI5dGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInRlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjEwdGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImVsZXZlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjExdGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInR3ZWx2ZXRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjEydGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInRoaXJ0ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTN0aFwiO1xuICAgICAgICAgICAgY2FzZSAxNDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZm91cnRlZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCIxNHRoXCI7XG4gICAgICAgICAgICBjYXNlIDE1OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJmaWZ0ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTV0aFwiO1xuICAgICAgICAgICAgY2FzZSAxNjpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwic2l4dGVlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjE2dGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInNldmVudGVlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjE3dGhcIjtcbiAgICAgICAgICAgIGNhc2UgMTg6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImVpZ2h0ZWVudGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMTh0aFwiO1xuICAgICAgICAgICAgY2FzZSAxOTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwibmludGVlbnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjE5dGhcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nZWQgPSBmbG9vcmVkLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdENoYXIgPSBzdHJpbmdlZC5zbGljZSgtMSk7XG4gICAgICAgICAgICAgICAgbGV0IHN1ZmZpeDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGxhc3RDaGFyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCIxXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWZmaXggPSBcInN0XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIjJcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeCA9IFwibmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiM1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgc3VmZml4ID0gXCJyZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWZmaXggPSBcInRoXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke2Zsb29yZWR9JHtzdWZmaXh9YDtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KERhdGUucHJvdG90eXBlLCBcImh1bWFuXCIsIHtcbiAgICBlbnVtZXJhYmxlOiBmYWxzZSwgdmFsdWUoKSB7XG4gICAgICAgIGxldCBkID0gdGhpcy5nZXRVVENEYXRlKCk7XG4gICAgICAgIGQgPSBkIDwgMTAgPyBgMCR7ZH1gIDogZDtcbiAgICAgICAgbGV0IG0gPSB0aGlzLmdldE1vbnRoKCkgKyAxO1xuICAgICAgICBtID0gbSA8IDEwID8gYDAke219YCA6IG07XG4gICAgICAgIGNvbnN0IHkgPSB0aGlzLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnRvVGltZVN0cmluZygpLnNsaWNlKDAsIDgpLnJlcGxhY2VBbGwoJzonLCAnLScpO1xuICAgICAgICByZXR1cm4gYCR7ZH1fJHttfV8ke3l9XyR7dH1gO1xuICAgIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEVycm9yLnByb3RvdHlwZSwgXCJ0b09ialwiLCB7XG4gICAgZW51bWVyYWJsZTogZmFsc2UsIHZhbHVlKCkge1xuICAgICAgICBjb25zdCB3aGVyZSA9IHRoaXMuc3RhY2suc2xpY2UodGhpcy5zdGFjay5zZWFyY2goLyg/PD1cXHMpYXQvKSwgdGhpcy5zdGFjay5zZWFyY2goLyg/PD1hdFxccy4qKVxcbi8pKTtcbiAgICAgICAgY29uc3Qgd2hhdCA9IHRoaXMubWVzc2FnZTtcbiAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcyk7XG4gICAgICAgIGNvbnN0IHJvb3RfYWJzX3BhdGggPSBzdG9yZS5nZXQoJ3Jvb3RfYWJzX3BhdGgnLCAnJyk7XG4gICAgICAgIGNvbnN0IGNsZWFuc3RhY2sgPSB0aGlzLnN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgLmZpbHRlcihzID0+IHMuaW5jbHVkZXMocm9vdF9hYnNfcGF0aCkgJiYgIXMuaW5jbHVkZXMoJ25vZGVfbW9kdWxlcycpKVxuICAgICAgICAgICAgLm1hcChzID0+IHtcbiAgICAgICAgICAgICAgICBzID0gcy50cmltKCk7XG4gICAgICAgICAgICAgICAgbGV0IGZyYW1lID0gcy5zbGljZShzLnNlYXJjaChyb290X2Fic19wYXRoKSwgcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICBsZXQgW2ZpbGUsIGxpbmVubywgLi4ucmVzdF0gPSBmcmFtZS5zcGxpdCgnOicpO1xuICAgICAgICAgICAgICAgIGZpbGUgPSBwYXRoLnJlbGF0aXZlKHJvb3RfYWJzX3BhdGgsIGZpbGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IGZpbGUsIGxpbmVubyB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7IHdoYXQsIHdoZXJlLCBjbGVhbnN0YWNrIH07XG4gICAgfVxufSk7XG4vLyAqKiogZnVuY3Rpb25zXG4vLyBjb25zdCB7QWxlcnR9ID0gcmVxdWlyZSgncHlhbm9fbG9jYWxfbW9kdWxlcy91dGlsL0FsZXJ0Jyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG4vLyBjb25zdCAkID0gcmVxdWlyZShcImpxdWVyeVwiKTtcbmNvbnN0IFN0b3JlID0gcmVxdWlyZShcImVsZWN0cm9uLXN0b3JlXCIpO1xuY29uc3Qgc3RvcmUgPSBuZXcgU3RvcmUoKTtcblxuLy8gc2tpcEZhZGUgPSBmYWxzZTtcblxuLypPYmplY3QuZGVmaW5lUHJvcGVydGllcygkLnByb3RvdHlwZSwge1xuICAgIGZhZGU6IHtcbiAgICAgICAgYXN5bmMgdmFsdWUoc3BlZWQsIHRvLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgbGV0IHNraXBGYWRlID0gc3RvcmUuZ2V0KCdza2lwRmFkZScsIGZhbHNlKTtcbiAgICAgICAgICAgIGlmIChza2lwRmFkZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnb3Qgc2tpcEZhZGUgPSB0cnVlIHN0YXJ0IG9mIGZuLCByZXR1cm5pbmcnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mYWRlVG8oMCwgdG8sIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzWzBdO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IFwiYnV0dG9uXCIpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoJ3VuY2xpY2thYmxlJywgdG8gPT0gMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcHJldk9wYWMgPSBlbGVtZW50LnN0eWxlLm9wYWNpdHk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHByZXZPcGFjICE9ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgcHJldk9wYWMgPSB0byA/IDAgOiAxOyAvLyBvcHBvc2l0ZVxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IHByZXZPcGFjO1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBkaWZmID0gTWF0aC5hYnMocHJldk9wYWMgLSB0byk7XG4gICAgICAgICAgICBsZXQgc3RlcDtcbiAgICAgICAgICAgIGlmICh0bykge1xuICAgICAgICAgICAgICAgIHN0ZXAgPSBkaWZmIC8gMzI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0ZXAgPSAtZGlmZiAvIDMyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZXZlcnlNcyA9IHV0aWwucm91bmQoc3BlZWQgLyAzMik7XG4gICAgICAgICAgICBmb3IgKGxldCBpIG9mIHV0aWwucmFuZ2UoMCwgMzEpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNraXBGYWRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnb3Qgc2tpcEZhZGUgPSB0cnVlIGluIGxvb3AsIHJldHVybmluZycpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mYWRlVG8oMCwgdG8sIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLm9wYWNpdHkpICsgc3RlcDtcbiAgICAgICAgICAgICAgICBhd2FpdCBhc3gud2FpdChldmVyeU1zKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mYWRlVG8oMCwgdG8sIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZGVhY3RpdmF0ZToge1xuICAgICAgICB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlQ2xhc3MoJ2luYWN0aXZlLWJ0bicsIHRydWUpXG4gICAgICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKCdhY3RpdmUtYnRuJywgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhY3RpdmF0ZToge1xuICAgICAgICB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlQ2xhc3MoJ2luYWN0aXZlLWJ0bicsIGZhbHNlKVxuICAgICAgICAgICAgICAgIC50b2dnbGVDbGFzcygnYWN0aXZlLWJ0bicsIHRydWUpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB0b2dnbGU6IHtcbiAgICAgICAgdmFsdWUoYWN0aXZhdGUpIHtcbiAgICAgICAgICAgIGFjdGl2YXRlID8gdGhpcy5hY3RpdmF0ZSgpIDogdGhpcy5kZWFjdGl2YXRlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGlzQWN0aXZlOiB7XG4gICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzQ2xhc3MoJ2FjdGl2ZS1idG4nKTtcbiAgICAgICAgfVxuICAgIH0sXG59KTsqL1xuXG5cbi8vICoqKiBmc3hcbi8qY29uc3QgZnN4ID0gKCgpID0+IHtcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbiAgICAvISoqQHBhcmFtIHtQYXRoTGlrZXxzdHJpbmd9IHBhdGhMaWtlXG4gICAgICogQHBhcmFtIHt7bW9kZT86bnVtYmVyLCByZWN1cnNpdmU/OmJvb2xlYW59fSBvcHRpb25zXG4gICAgICogQHJldHVybiB7UHJvbWlzZTxib29sZWFuPn0qIS9cbiAgICBjb25zdCBta2RpciA9IChwYXRoTGlrZSwgb3B0aW9ucykgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PlxuICAgICAgICBmcy5ta2RpcihwYXRoTGlrZSwgb3B0aW9ucywgZXJyID0+IHJlc29sdmUoIXV0aWwuYm9vbChlcnIpKSkpO1xuXG5cbiAgICAvISoqQHBhcmFtIHtQYXRoTGlrZXxzdHJpbmd9IHBhdGhMaWtlXG4gICAgICogQHJldHVybiB7UHJvbWlzZTxib29sZWFuPn0qIS9cbiAgICBmdW5jdGlvbiBwYXRoX2V4aXN0cyhwYXRoTGlrZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PlxuICAgICAgICAgICAgZnMuYWNjZXNzKHBhdGhMaWtlLCBmcy5jb25zdGFudHMuRl9PSywgZXJyID0+IHJlc29sdmUoIXV0aWwuYm9vbChlcnIpKSkpO1xuICAgIH1cblxuICAgIC8hKipcbiAgICAge0BsaW5rIHJlbW92ZV9leHQgVXNlcyByZW1vdmVfZXh0fVxuICAgICBAcGFyYW0ge1BhdGhMaWtlfHN0cmluZ30gcGF0aExpa2VcbiAgICAgQHBhcmFtIHtzdHJpbmd9IGV4dCAtIFRhcmdldCBleHRlbnNpb24gd2l0aG91dCBkb3RcbiAgICAgQHJldHVybiB7c3RyaW5nfSohL1xuICAgIGNvbnN0IHJlcGxhY2VfZXh0ID0gKHBhdGhMaWtlLCBleHQpID0+IHtcbiAgICAgICAgaWYgKGV4dC5pbmNsdWRlcygnLicpKSB7XG4gICAgICAgICAgICBhbGVydChgZXh0IGluY2x1ZGVkIGRvdCBcIi5cIiwgZXh0OiAke2V4dH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7cmVtb3ZlX2V4dChwYXRoTGlrZSl9LiR7ZXh0fWA7XG4gICAgfTtcblxuICAgIC8hKipcbiAgICAgKiBAcGFyYW0ge1BhdGhMaWtlfHN0cmluZ30gcGF0aExpa2VcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICogQGV4YW1wbGVcbiAgICAgKiByZW1vdmVfZXh0KFwiZXhwZXJpbWVudHMvdHJ1dGhzL2Z1cl9lbGlzZV9CLnR4dFwiKVxuICAgICAqID4+PiBleHBlcmltZW50cy90cnV0aHMvZnVyX2VsaXNlX0JcbiAgICAgKiByZW1vdmVfZXh0KFwiZnVyX2VsaXNlX0IudHh0XCIpXG4gICAgICogPj4+IGZ1cl9lbGlzZV9CICohL1xuICAgIGNvbnN0IHJlbW92ZV9leHQgPSBwYXRoTGlrZSA9PiBwYXRoLmpvaW4ocGF0aC5kaXJuYW1lKHBhdGhMaWtlKSwgcGF0aC5iYXNlbmFtZShwYXRoTGlrZSwgcGF0aC5leHRuYW1lKHBhdGhMaWtlKSkpO1xuXG4gICAgLyEqKlxuICAgICAqIHtAbGluayByZW1vdmVfZXh0IFVzZXMgcmVtb3ZlX2V4dH1cbiAgICAgKiBAcGFyYW0ge1BhdGhMaWtlfHN0cmluZ30gcGF0aExpa2VcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHB1c2hcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICogKiEvXG4gICAgY29uc3QgcHVzaF9iZWZvcmVfZXh0ID0gKHBhdGhMaWtlLCBwdXNoKSA9PiB7XG4gICAgICAgIGxldCBleHQgPSBwYXRoLmV4dG5hbWUocGF0aExpa2UpO1xuICAgICAgICByZXR1cm4gYCR7cmVtb3ZlX2V4dChwYXRoTGlrZSl9JHtwdXNofSR7ZXh0fWA7XG4gICAgfTtcblxuICAgIC8hKipAcGFyYW0ge3N0cmluZ3xQYXRoTGlrZX0gcGF0aExpa2VcbiAgICAgKiBAcGFyYW0gez9zdHJpbmd9IGV4dCohL1xuICAgIGZ1bmN0aW9uIGJhc2VuYW1lKHBhdGhMaWtlLCBleHQgPSBudWxsKSB7XG4gICAgICAgIGlmICghZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gcGF0aC5iYXNlbmFtZShwYXRoTGlrZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdGguYmFzZW5hbWUocGF0aExpa2UsIGV4dCk7XG4gICAgfVxuXG4gICAgLyEqKkBwYXJhbSB7Li4uc3RyaW5nfSBwYXRoc1xuICAgICAqIEByZXR1cm4ge3N0cmluZ1tdfVxuICAgICAqICohL1xuICAgIGZ1bmN0aW9uIGJhc2VuYW1lcyguLi5wYXRocykge1xuICAgICAgICByZXR1cm4gWy4uLnBhdGhzLm1hcChwID0+IHBhdGguYmFzZW5hbWUocCkpXTtcbiAgICB9XG5cbiAgICAvISoqQHBhcmFtIHtzdHJpbmd9IHBhdGhMaWtlXG4gICAgICogQHJldHVybiB7c3RyaW5nfSohL1xuICAgIGZ1bmN0aW9uIGRpcm5hbWUocGF0aExpa2UpIHtcbiAgICAgICAgcmV0dXJuIHBhdGguZGlybmFtZShwYXRoTGlrZSk7XG4gICAgfVxuXG4gICAgLyEqKkBwYXJhbSB7c3RyaW5nfSBwYXRoTGlrZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ30qIS9cbiAgICBmdW5jdGlvbiBleHRuYW1lKHBhdGhMaWtlKSB7XG4gICAgICAgIHJldHVybiBwYXRoLmV4dG5hbWUocGF0aExpa2UpO1xuICAgIH1cblxuICAgIC8hKipAcGFyYW0ge3N0cmluZ30gcGF0aExpa2UqIS9cbiAgICBmdW5jdGlvbiByZW1vdmUocGF0aExpa2UpIHtcbiAgICAgICAgZnMudW5saW5rU3luYyhwYXRoTGlrZSk7XG4gICAgfVxuXG4gICAgLyEqKiBAdHlwZSB7e1xuICAgICAqIGJhc2VuYW1lOihmdW5jdGlvbihzdHJpbmd8UGF0aExpa2UsP3N0cmluZyk6c3RyaW5nKSxcbiAgICAgKiBiYXNlbmFtZXM6KGZ1bmN0aW9uKC4uLnN0cmluZ3xQYXRoTGlrZSk6c3RyaW5nW10pLFxuICAgICAqIGRpcm5hbWU6KGZ1bmN0aW9uKC4uLnN0cmluZ3xQYXRoTGlrZSk6c3RyaW5nKSxcbiAgICAgKiBleHRuYW1lOihmdW5jdGlvbiguLi5zdHJpbmd8UGF0aExpa2UpOnN0cmluZyksXG4gICAgICogbWtkaXI6IChmdW5jdGlvbigoUGF0aExpa2V8c3RyaW5nKSwgKG51bWJlcnxzdHJpbmd8TWFrZURpcmVjdG9yeU9wdGlvbnN8dW5kZWZpbmVkfG51bGwpKTogUHJvbWlzZTxib29sZWFuPiksXG4gICAgICogcGF0aF9leGlzdHM6IChmdW5jdGlvbigoUGF0aExpa2V8c3RyaW5nKSk6IFByb21pc2U8Ym9vbGVhbj4pLFxuICAgICAqIHB1c2hfYmVmb3JlX2V4dDogKGZ1bmN0aW9uKChQYXRoTGlrZXxzdHJpbmcpLCAoc3RyaW5nfG51bWJlcikpOiBzdHJpbmcpLFxuICAgICAqIHJlbW92ZV9leHQ6IChmdW5jdGlvbigoUGF0aExpa2V8c3RyaW5nKSk6IHN0cmluZyksXG4gICAgICogcmVwbGFjZV9leHQ6IChmdW5jdGlvbigoUGF0aExpa2V8c3RyaW5nKSwgc3RyaW5nKTogc3RyaW5nKX19XG4gICAgICogKiEvXG4gICAgcmV0dXJuIHsgYmFzZW5hbWVzLCBiYXNlbmFtZSwgZGlybmFtZSwgZXh0bmFtZSwgbWtkaXIsIHBhdGhfZXhpc3RzLCByZXBsYWNlX2V4dCwgcmVtb3ZlX2V4dCwgcmVtb3ZlLCBwdXNoX2JlZm9yZV9leHQgfTtcbn0pKCk7XG5jb25zdCBhc3ggPSAoKCkgPT4ge1xuICAgIC8hKipAcGFyYW0ge251bWJlcn0gbXNcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfSohL1xuICAgIGFzeW5jIGZ1bmN0aW9uIHdhaXQobXMpIHtcblxuICAgICAgICBpZiAoc3RvcmUuZ2V0KCdza2lwRmFkZScsIGZhbHNlKSkge1xuICAgICAgICAgICAgbXMgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgICB9XG5cbiAgICAvISoqQHBhcmFtIHtqUXVlcnl9IGpRdWVyeVxuICAgICBAcGFyYW0ge251bWJlcn0gbXNcbiAgICAgQHJldHVybiB7UHJvbWlzZTxqUXVlcnk+fSohL1xuICAgIGNvbnN0ICRmYWRlT3V0ID0gKGpRdWVyeSwgbXMpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4galF1ZXJ5LmZhZGUobXMsIDAsIHJlc29sdmUpKTtcblxuICAgIC8hKipAcGFyYW0ge2pRdWVyeX0galF1ZXJ5XG4gICAgIEBwYXJhbSB7bnVtYmVyfSBtc1xuICAgICBAcmV1dHJuIHtQcm9taXNlPGpRdWVyeT59KiEvXG4gICAgY29uc3QgJGZhZGVJbiA9IChqUXVlcnksIG1zKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IGpRdWVyeS5mYWRlKG1zLCAxLCByZXNvbHZlKSk7XG5cbiAgICAvISoqQHBhcmFtIHtudW1iZXJ9IG1zXG4gICAgIEBwYXJhbSB7Li4ualF1ZXJ5fSBqUXVlcmllc1xuICAgICBAcmV0dXJuIHtQcm9taXNlPGpRdWVyeVtdPn0qIS9cbiAgICBhc3luYyBmdW5jdGlvbiAkZmFkZUluTWFueShtcywgLi4ualF1ZXJpZXMpIHtcbiAgICAgICAgbGV0IHByb21pc2VzID0gW107XG4gICAgICAgIGZvciAobGV0IGpRIG9mIGpRdWVyaWVzKSB7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKCRmYWRlSW4oalEsIG1zKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgIH1cblxuICAgIC8hKipAcGFyYW0ge251bWJlcn0gbXNcbiAgICAgQHBhcmFtIHsuLi5qUXVlcnl9IGpRdWVyaWVzXG4gICAgIEByZXR1cm4ge1Byb21pc2U8alF1ZXJ5W10+fSohL1xuICAgIGFzeW5jIGZ1bmN0aW9uICRmYWRlT3V0TWFueShtcywgLi4ualF1ZXJpZXMpIHtcbiAgICAgICAgbGV0IHByb21pc2VzID0gW107XG4gICAgICAgIGZvciAobGV0IGpRIG9mIGpRdWVyaWVzKSB7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKCRmYWRlT3V0KGpRLCBtcykpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICB9XG5cblxuICAgIGFzeW5jIGZ1bmN0aW9uIGNvbmN1cnJlbnQoLi4ucHJvbWlzZXMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICB9XG5cbiAgICAvISoqQHRlbXBsYXRlIFRcbiAgICAgKiBAcGFyYW0gey4uLmZ1bmN0aW9uKCk6UHJvbWlzZTxUPnxUfHZvaWR9IGZuc1xuICAgICAqIEByZXR1cm4ge1Byb21pc2U8VFtdPn0qIS9cbiAgICBhc3luYyBmdW5jdGlvbiB3YXRlcmZhbGwoLi4uZm5zKSB7XG4gICAgICAgIGZvciAobGV0IGZuIG9mIGZucykge1xuICAgICAgICAgICAgYXdhaXQgZm4oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8hKipAdHlwZSB7XG4gICAgICogICAgIHtcbiAgICAgKiAgICAgICAgICRmYWRlSW46IChmdW5jdGlvbihqUXVlcnksIG51bWJlcik6IFByb21pc2U8alF1ZXJ5PiksXG4gICAgICogICAgICAgICAkZmFkZUluTWFueTogKGZ1bmN0aW9uKG51bWJlciwgLi4ualF1ZXJ5KTogalF1ZXJ5W10pLFxuICAgICAqICAgICAgICAgJGZhZGVPdXQ6IChmdW5jdGlvbihqUXVlcnksIG51bWJlcik6IFByb21pc2U8alF1ZXJ5PiksXG4gICAgICogICAgICAgICAkZmFkZU91dE1hbnk6IChmdW5jdGlvbihudW1iZXIsIC4uLmpRdWVyeSk6IGpRdWVyeVtdKSxcbiAgICAgKiAgICAgICAgIGNvbmN1cnJlbnQ6IChmdW5jdGlvbiguLi5mdW5jdGlvbigpOiBUKTogVFtdKVxuICAgICAqICAgICAgICAgd2FpdDogKGZ1bmN0aW9uKG51bWJlcik6IFByb21pc2U8Kj4pLFxuICAgICAqICAgICB9XG4gICAgICogfVxuICAgICAqIEB0ZW1wbGF0ZSBUKiEvXG4gICAgY29uc3QgbmV3VmFyID0ge1xuICAgICAgICAkZmFkZUluLFxuICAgICAgICAkZmFkZU91dCxcbiAgICAgICAgJGZhZGVPdXRNYW55LFxuICAgICAgICAkZmFkZUluTWFueSxcbiAgICAgICAgY29uY3VycmVudCxcbiAgICAgICAgd2FpdCxcbiAgICAgICAgd2F0ZXJmYWxsLFxuICAgIH07XG4gICAgcmV0dXJuIG5ld1Zhcjtcbn0pKCk7Ki9cblxuXG5jb25zb2xlLmxvZygncmVuZGVyZXIuanMgRU9GJyk7XG5jb25zb2xlLmdyb3VwRW5kKCk7XG5cbiJdfQ==