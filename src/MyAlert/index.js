"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.group('src/MyAlert/index.ts');
const bhe_1 = require("../bhe");
const sweetalert2_1 = require("sweetalert2");
console.log(`Swal:`, sweetalert2_1.default);
const smallMixin = sweetalert2_1.default.mixin({
    animation: false,
    position: "bottom-start",
    showConfirmButton: false,
    timer: 8000,
    toast: true,
});
const withConfirm = {
    cancelButtonText: "No",
    confirmButtonText: "Yes",
    showCancelButton: true,
    showConfirmButton: true,
    timer: null,
};
const blockingOptions = {
    allowEnterKey: false,
    allowEscapeKey: false,
    allowOutsideClick: false,
    animation: false,
    showCancelButton: false,
    showCloseButton: false,
    showConfirmButton: false,
    width: "75vw",
};
const threeButtonsOptions = Object.assign(Object.assign({}, blockingOptions), { showConfirmButton: true, showCancelButton: true });
const blockingSwalMixin = sweetalert2_1.default.mixin(blockingOptions);
const small = {
    _question(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'question' }));
    },
    _info(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'info' }));
    },
    _success(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'success' }));
    },
    _error(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'error' }));
    },
    _warning(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { showConfirmButton: true, type: 'warning' }));
    },
    error(title, text) {
        return smallMixin.fire({
            title,
            text,
            icon: "error",
        });
    },
    info(title, text = null, showConfirmBtns = false) {
        let infoOptions = {
            title,
            text,
            type: "info",
        };
        if (showConfirmBtns) {
            infoOptions = Object.assign(Object.assign({}, infoOptions), withConfirm);
        }
        return smallMixin.fire(infoOptions);
    },
    success(title, text = null, timer = 6000) {
        return smallMixin.fire({
            title,
            text,
            icon: "success",
            timer
        });
    },
    warning(title, text = null) {
        let warningOptions = {
            title,
            text,
            showConfirmButton: true,
            timer: null,
            type: "warning"
        };
        return smallMixin.fire(warningOptions);
    },
};
const big = {
    async error(options) {
        var _a;
        if (((_a = options) === null || _a === void 0 ? void 0 : _a.html) instanceof Error) {
            const error = options.html;
            const { what, where, cleanstack } = error.toObj();
            console.warn('Error!', error, { cleanstack });
            options.html = `${what}<p>${where}</p>`;
        }
        const dirname = new Date().human();
        const { default: Glob } = require('../Glob');
        return blockingSwalMixin.fire(Object.assign({ type: 'error', showConfirmButton: true }, options));
    },
    warning(options) {
        if (options.animation === false) {
            options = Object.assign({ customClass: null }, options);
        }
        return blockingSwalMixin.fire(Object.assign(Object.assign(Object.assign({}, withConfirm), { type: 'warning' }), options));
    },
    blocking(options, moreOptions) {
        if (moreOptions && moreOptions.strings && moreOptions.clickFn) {
            let { strings, clickFn } = moreOptions;
            let paragraphs = strings
                .map(s => bhe_1.paragraph({ cls: 'clickable', text: s }))
                .map(pElem => pElem.click(() => clickFn(pElem)));
            options = Object.assign(Object.assign({}, options), { onBeforeOpen(modalElement) {
                    console.log('modalElement:', modalElement);
                    return bhe_1.elem({ byid: 'swal2-content' })
                        .append(...paragraphs);
                } });
        }
        else {
            options = Object.assign({ showConfirmButton: true, showCancelButton: true }, options);
        }
        if (options.showConfirmButton || options.showCancelButton || options.onOpen) {
            return sweetalert2_1.default.fire(Object.assign(Object.assign({}, blockingOptions), options));
        }
        else {
            return new Promise(resolve => sweetalert2_1.default.fire(Object.assign(Object.assign(Object.assign({}, blockingOptions), options), { onOpen: v => resolve(v) })));
        }
    },
    oneButton(title, options) {
        return blockingSwalMixin.fire(Object.assign({ title: title, showConfirmButton: true, customClass: 'animated fadeIn' }, options));
    },
    async twoButtons(options) {
        const { value } = await sweetalert2_1.default.fire(Object.assign({ showCancelButton: true, customClass: 'animated fadeIn' }, options));
        return value ? "confirm" : "second";
    },
    async threeButtons(options) {
        let thirdButtonCss;
        if (options.thirdButtonType === "warning") {
            thirdButtonCss = { backgroundColor: '#FFC66D', color: 'black' };
        }
        console.log({ thirdButtonCss });
        let action;
        const onBeforeOpen = (modal) => {
            let el = bhe_1.elem({
                htmlElement: modal,
                children: { actions: '.swal2-actions' }
            });
            el.actions.append(bhe_1.button({ cls: `swal2-confirm swal2-styled`, html: options.thirdButtonText })
                .css(thirdButtonCss)
                .click(async (ev) => {
                action = "third";
                sweetalert2_1.default.clickConfirm();
            }));
        };
        options = Object.assign(Object.assign({}, options), { onBeforeOpen, showCancelButton: true });
        const { value } = await sweetalert2_1.default.fire(options);
        if (value) {
            if (action === undefined) {
                action = "confirm";
            }
        }
        else {
            action = "cancel";
        }
        return action;
    }
};
exports.default = Object.assign({ small, big }, sweetalert2_1.default);
console.log('src/MyAlert/index.ts EOF');
console.groupEnd();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUN0QyxnQ0FBb0U7QUFDcEUsNkNBQXNEO0FBR3RELE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLHFCQUFJLENBQUMsQ0FBQztBQUUzQixNQUFNLFVBQVUsR0FBRyxxQkFBSSxDQUFDLEtBQUssQ0FBQztJQUMxQixTQUFTLEVBQUUsS0FBSztJQUVoQixRQUFRLEVBQUUsY0FBYztJQUN4QixpQkFBaUIsRUFBRSxLQUFLO0lBQ3hCLEtBQUssRUFBRSxJQUFJO0lBQ1gsS0FBSyxFQUFFLElBQUk7Q0FFZCxDQUFDLENBQUM7QUFDSCxNQUFNLFdBQVcsR0FBRztJQUNoQixnQkFBZ0IsRUFBRSxJQUFJO0lBQ3RCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsZ0JBQWdCLEVBQUUsSUFBSTtJQUN0QixpQkFBaUIsRUFBRSxJQUFJO0lBQ3ZCLEtBQUssRUFBRSxJQUFJO0NBRWQsQ0FBQztBQUNGLE1BQU0sZUFBZSxHQUFzQjtJQUN2QyxhQUFhLEVBQUUsS0FBSztJQUNwQixjQUFjLEVBQUUsS0FBSztJQUNyQixpQkFBaUIsRUFBRSxLQUFLO0lBQ3hCLFNBQVMsRUFBRSxLQUFLO0lBRWhCLGdCQUFnQixFQUFFLEtBQUs7SUFDdkIsZUFBZSxFQUFFLEtBQUs7SUFDdEIsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixLQUFLLEVBQUUsTUFBTTtDQUdoQixDQUFDO0FBQ0YsTUFBTSxtQkFBbUIsbUNBQ2xCLGVBQWUsS0FDbEIsaUJBQWlCLEVBQUUsSUFBSSxFQUN2QixnQkFBZ0IsRUFBRSxJQUFJLEdBQ3pCLENBQUM7QUFDRixNQUFNLGlCQUFpQixHQUFHLHFCQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBR3RELE1BQU0sS0FBSyxHQUFHO0lBQ1YsU0FB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dXJjZXNDb250ZW50IjpbIi8qKmltcG9ydCBBbGVydCBmcm9tICdNeUFsZXJ0JyAob3IgYW55IG90aGVyIG5hbWUpKi9cbmNvbnNvbGUuZ3JvdXAoJ3NyYy9NeUFsZXJ0L2luZGV4LnRzJyk7XG5pbXBvcnQgeyBCZXR0ZXJIVE1MRWxlbWVudCwgYnV0dG9uLCBlbGVtLCBwYXJhZ3JhcGggfSBmcm9tIFwiLi4vYmhlXCI7XG5pbXBvcnQgU3dhbCwgeyBTd2VldEFsZXJ0T3B0aW9ucyB9IGZyb20gJ3N3ZWV0YWxlcnQyJztcblxuXG5jb25zb2xlLmxvZyhgU3dhbDpgLCBTd2FsKTtcblxuY29uc3Qgc21hbGxNaXhpbiA9IFN3YWwubWl4aW4oe1xuICAgIGFuaW1hdGlvbjogZmFsc2UsXG4gICAgLy8gY3VzdG9tQ2xhc3M6ICdhbmltYXRlZCBmYWRlSW4nLFxuICAgIHBvc2l0aW9uOiBcImJvdHRvbS1zdGFydFwiLFxuICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSxcbiAgICB0aW1lcjogODAwMCxcbiAgICB0b2FzdDogdHJ1ZSxcblxufSk7XG5jb25zdCB3aXRoQ29uZmlybSA9IHtcbiAgICBjYW5jZWxCdXR0b25UZXh0OiBcIk5vXCIsXG4gICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzXCIsXG4gICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSxcbiAgICB0aW1lcjogbnVsbCxcblxufTtcbmNvbnN0IGJsb2NraW5nT3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMgPSB7XG4gICAgYWxsb3dFbnRlcktleTogZmFsc2UsXG4gICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLFxuICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSxcbiAgICBhbmltYXRpb246IGZhbHNlLFxuICAgIC8vIGN1c3RvbUNsYXNzOiAnYW5pbWF0ZWQgZmFkZUluJyxcbiAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwgLy8gZGVmYXVsdCBmYWxzZVxuICAgIHNob3dDbG9zZUJ1dHRvbjogZmFsc2UsIC8vIGRlZmF1bHQgZmFsc2VcbiAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsXG4gICAgd2lkdGg6IFwiNzV2d1wiLFxuXG5cbn07XG5jb25zdCB0aHJlZUJ1dHRvbnNPcHRpb25zID0ge1xuICAgIC4uLmJsb2NraW5nT3B0aW9ucyxcbiAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSxcbiAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxufTtcbmNvbnN0IGJsb2NraW5nU3dhbE1peGluID0gU3dhbC5taXhpbihibG9ja2luZ09wdGlvbnMpO1xuXG5cbmNvbnN0IHNtYWxsID0ge1xuICAgIF9xdWVzdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoeyAuLi5vcHRpb25zLCB0eXBlOiAncXVlc3Rpb24nIH0pXG4gICAgfSxcbiAgICBfaW5mbyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoeyAuLi5vcHRpb25zLCB0eXBlOiAnaW5mbycgfSlcbiAgICB9LFxuICAgIF9zdWNjZXNzKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7IC4uLm9wdGlvbnMsIHR5cGU6ICdzdWNjZXNzJyB9KVxuICAgIH0sXG4gICAgX2Vycm9yKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7IC4uLm9wdGlvbnMsIHR5cGU6ICdlcnJvcicgfSlcbiAgICB9LFxuICAgIF93YXJuaW5nKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsIHR5cGU6ICd3YXJuaW5nJ1xuICAgICAgICB9KVxuICAgIH0sXG4gICAgZXJyb3IodGl0bGUsIHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICBpY29uOiBcImVycm9yXCIsXG5cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbmZvKHRpdGxlLCB0ZXh0ID0gbnVsbCwgc2hvd0NvbmZpcm1CdG5zID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IGluZm9PcHRpb25zID0ge1xuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgdHlwZTogXCJpbmZvXCIsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChzaG93Q29uZmlybUJ0bnMpIHtcbiAgICAgICAgICAgIGluZm9PcHRpb25zID0geyAuLi5pbmZvT3B0aW9ucywgLi4ud2l0aENvbmZpcm0gfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoaW5mb09wdGlvbnMpO1xuICAgIH0sXG4gICAgc3VjY2Vzcyh0aXRsZSwgdGV4dCA9IG51bGwsIHRpbWVyID0gNjAwMCkge1xuXG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoe1xuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgaWNvbjogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICB0aW1lclxuICAgICAgICB9KVxuICAgIH0sXG4gICAgd2FybmluZyh0aXRsZSwgdGV4dCA9IG51bGwpIHtcbiAgICAgICAgbGV0IHdhcm5pbmdPcHRpb25zID0ge1xuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgICAgICAgICB0aW1lcjogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHdhcm5pbmdPcHRpb25zKTtcbiAgICB9LFxuXG59O1xuXG5cbmNvbnN0IGJpZyA9IHtcbiAgICBhc3luYyBlcnJvcihvcHRpb25zKSB7XG5cbiAgICAgICAgaWYgKG9wdGlvbnM/Lmh0bWwgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBvcHRpb25zLmh0bWw7XG5cblxuICAgICAgICAgICAgY29uc3QgeyB3aGF0LCB3aGVyZSwgY2xlYW5zdGFjayB9ID0gZXJyb3IudG9PYmooKTtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRXJyb3IhJywgZXJyb3IsIHsgY2xlYW5zdGFjayB9KTtcbiAgICAgICAgICAgIG9wdGlvbnMuaHRtbCA9IGAke3doYXR9PHA+JHt3aGVyZX08L3A+YFxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpcm5hbWUgPSBuZXcgRGF0ZSgpLmh1bWFuKCk7XG4gICAgICAgIGNvbnN0IHsgZGVmYXVsdDogR2xvYiB9ID0gcmVxdWlyZSgnLi4vR2xvYicpO1xuICAgICAgICAvKmlmIChMT0cgfHwgIUdsb2IuQmlnQ29uZmlnLmdldCgnZGV2JykpIHtcbiAgICAgICAgICAgIG9wdGlvbnMub25PcGVuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRha2VTY3JlZW5zaG90KGRpcm5hbWUpO1xuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgb3B0aW9ucy5vbkFmdGVyQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgd2FpdCg1MDApO1xuICAgICAgICAgICAgICAgIGF3YWl0IHRha2VTY3JlZW5zaG90KGRpcm5hbWUpO1xuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgb3B0aW9ucy5odG1sICs9IGA8cD5Mb2dzIGFuZCBzY3JlZW5zaG90IHNhdmVkIHRvIGVycm9ycy8ke3BhdGguYmFzZW5hbWUoU0VTU0lPTl9QQVRIX0FCUyl9LyR7ZGlybmFtZX08L3A+YFxuICAgICAgICB9Ki9cblxuICAgICAgICByZXR1cm4gYmxvY2tpbmdTd2FsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgd2FybmluZyhvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmFuaW1hdGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7IGN1c3RvbUNsYXNzOiBudWxsLCAuLi5vcHRpb25zIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJsb2NraW5nU3dhbE1peGluLmZpcmUoeyAuLi53aXRoQ29uZmlybSwgdHlwZTogJ3dhcm5pbmcnLCAuLi5vcHRpb25zIH0pO1xuICAgIH0sXG5cbiAgICBibG9ja2luZyhvcHRpb25zLCBtb3JlT3B0aW9ucykge1xuXG4gICAgICAgIGlmIChtb3JlT3B0aW9ucyAmJiBtb3JlT3B0aW9ucy5zdHJpbmdzICYmIG1vcmVPcHRpb25zLmNsaWNrRm4pIHtcbiAgICAgICAgICAgIGxldCB7IHN0cmluZ3MsIGNsaWNrRm4gfSA9IG1vcmVPcHRpb25zO1xuXG4gICAgICAgICAgICBsZXQgcGFyYWdyYXBocyA9IHN0cmluZ3NcbiAgICAgICAgICAgICAgICAvLyAubWFwKHMgPT4gJChgPHAgY2xhc3M9XCJjbGlja2FibGVcIj4ke3N9PC9wPmApKVxuICAgICAgICAgICAgICAgIC5tYXAocyA9PiBwYXJhZ3JhcGgoeyBjbHM6ICdjbGlja2FibGUnLCB0ZXh0OiBzIH0pKVxuICAgICAgICAgICAgICAgIC5tYXAocEVsZW0gPT4gcEVsZW0uY2xpY2soKCkgPT4gY2xpY2tGbihwRWxlbSkpKTtcblxuICAgICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgICAgIG9uQmVmb3JlT3Blbihtb2RhbEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ21vZGFsRWxlbWVudDonLCBtb2RhbEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbSh7IGJ5aWQ6ICdzd2FsMi1jb250ZW50JyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gLnNob3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCguLi5wYXJhZ3JhcGhzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgeyAvLyBmb3JjZSBjb25maXJtIGFuZCBjYW5jZWwgYnV0dG9uc1xuICAgICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnNob3dDb25maXJtQnV0dG9uIHx8IG9wdGlvbnMuc2hvd0NhbmNlbEJ1dHRvbiB8fCBvcHRpb25zLm9uT3Blbikge1xuICAgICAgICAgICAgLy8gLyBIYXBwZW5zIHdoZW4gbm90IG9yIGJhZCBtb3JlT3B0aW9uc1xuICAgICAgICAgICAgcmV0dXJuIFN3YWwuZmlyZSh7IC4uLmJsb2NraW5nT3B0aW9ucywgLi4ub3B0aW9ucyB9KTtcbiAgICAgICAgfSBlbHNlIHsgLy8gVE9ETzogb25PcGVuIDogcmVzb2x2ZT9cblxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gU3dhbC5maXJlKHsgLi4uYmxvY2tpbmdPcHRpb25zLCAuLi5vcHRpb25zLCBvbk9wZW46IHYgPT4gcmVzb2x2ZSh2KSB9KSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25lQnV0dG9uKHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIC8qY29uc29sZS5sb2coeyB0aXRsZSwgb3B0aW9ucyB9KTtcbiAgICAgICAgIGNvbnN0IHR5cGVvZnRpdGxlID0gdHlwZW9mIHRpdGxlO1xuICAgICAgICAgaWYgKCB0eXBlb2Z0aXRsZSA9PT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgIGlmICggb3B0aW9ucyApIHtcbiAgICAgICAgIGlmICggb3B0aW9ucy5odG1sICkge1xuICAgICAgICAgb3B0aW9ucy5odG1sICs9ICc8YnI+JztcbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICBvcHRpb25zLmh0bWwgPSAnJztcbiAgICAgICAgIH1cbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICBvcHRpb25zID0geyBodG1sIDogJycgfTtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmICggdGl0bGUgaW5zdGFuY2VvZiBFcnJvciApIHtcbiAgICAgICAgIHRpdGxlID0gJ0FuIGVycm9yIGhhcyBvY2N1cnJlZCc7XG4gICAgICAgICBvcHRpb25zLmh0bWwgKz0gdGl0bGUubWVzc2FnZTtcbiAgICAgICAgIGNvbnNvbGUubG9nKHsgdGl0bGUsIG9wdGlvbnMgfSk7XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgbGV0IGh0bWwgPSBgPHN0eWxlPlxuICAgICAgICAgc3BhbiB7XG4gICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xuICAgICAgICAgbWFyZ2luLWxlZnQ6IDQwcHg7XG4gICAgICAgICB9XG4gICAgICAgICA8L3N0eWxlPlxuICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGxlZnRcIj5cblxuICAgICAgICAgYDtcbiAgICAgICAgIGZvciAoIGxldCBrZXkgb2YgT2JqZWN0LmtleXModGl0bGUpICkge1xuICAgICAgICAgaHRtbCArPSBgPHA+PGI+JHtrZXl9OjwvYj4gPHNwYW4+JHt0aXRsZVtrZXldfTwvc3Bhbj48L3A+YFxuICAgICAgICAgfVxuICAgICAgICAgaHRtbCArPSBgPC9kaXY+YDtcbiAgICAgICAgIG9wdGlvbnMuaHRtbCArPSBodG1sO1xuICAgICAgICAgdGl0bGUgPSAnU29tZXRoaW5nIGhhcHBlbmVkJztcblxuICAgICAgICAgfVxuICAgICAgICAgfSBlbHNlIGlmICggQXJyYXkuaXNBcnJheSh0aXRsZSkgKSB7XG4gICAgICAgICB0aXRsZSA9ICdUaGlzIGlzIHdlaXJkJztcbiAgICAgICAgIG9wdGlvbnMuaHRtbCArPSB0aXRsZS5qb2luKCc8L2JyPicpXG4gICAgICAgICB9Ki9cbiAgICAgICAgcmV0dXJuIGJsb2NraW5nU3dhbE1peGluLmZpcmUoe1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgY3VzdG9tQ2xhc3M6ICdhbmltYXRlZCBmYWRlSW4nLFxuXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgdHdvQnV0dG9ucyhvcHRpb25zKSB7XG5cbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gYXdhaXQgU3dhbC5maXJlKHtcblxuICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgIGN1c3RvbUNsYXNzOiAnYW5pbWF0ZWQgZmFkZUluJyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlID8gXCJjb25maXJtXCIgOiBcInNlY29uZFwiO1xuICAgIH0sXG4gICAgYXN5bmMgdGhyZWVCdXR0b25zKG9wdGlvbnMpIHtcblxuICAgICAgICAvLyBjb25zdCB0aGlyZEJ1dHRvblRleHQgPSBvcHRpb25zLnRoaXJkQnV0dG9uVGV4dCA/PyAnT3ZlcndyaXRlJztcbiAgICAgICAgbGV0IHRoaXJkQnV0dG9uQ3NzO1xuICAgICAgICBpZiAob3B0aW9ucy50aGlyZEJ1dHRvblR5cGUgPT09IFwid2FybmluZ1wiKSB7XG4gICAgICAgICAgICB0aGlyZEJ1dHRvbkNzcyA9IHsgYmFja2dyb3VuZENvbG9yOiAnI0ZGQzY2RCcsIGNvbG9yOiAnYmxhY2snIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKHsgdGhpcmRCdXR0b25Dc3MgfSk7XG4gICAgICAgIGxldCBhY3Rpb247XG4gICAgICAgIGNvbnN0IG9uQmVmb3JlT3BlbiA9IChtb2RhbCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsID0gZWxlbSh7XG4gICAgICAgICAgICAgICAgaHRtbEVsZW1lbnQ6IG1vZGFsLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB7IGFjdGlvbnM6ICcuc3dhbDItYWN0aW9ucycgfVxuICAgICAgICAgICAgfSkgYXMgQmV0dGVySFRNTEVsZW1lbnQgJiB7IGFjdGlvbnM6IEJldHRlckhUTUxFbGVtZW50IH07XG5cbiAgICAgICAgICAgIGVsLmFjdGlvbnMuYXBwZW5kKFxuICAgICAgICAgICAgICAgIGJ1dHRvbih7IGNsczogYHN3YWwyLWNvbmZpcm0gc3dhbDItc3R5bGVkYCwgaHRtbDogb3B0aW9ucy50aGlyZEJ1dHRvblRleHQgfSlcblxuICAgICAgICAgICAgICAgICAgICAuY3NzKHRoaXJkQnV0dG9uQ3NzKVxuICAgICAgICAgICAgICAgICAgICAuY2xpY2soYXN5bmMgKGV2KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSBcInRoaXJkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBTd2FsLmNsaWNrQ29uZmlybSgpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICB9O1xuICAgICAgICBvcHRpb25zID0geyAuLi5vcHRpb25zLCBvbkJlZm9yZU9wZW4sIHNob3dDYW5jZWxCdXR0b246IHRydWUgfTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gYXdhaXQgU3dhbC5maXJlKG9wdGlvbnMpO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIC8vLyBFaXRoZXIgdXNlciBjbGlja2VkIENvbmZpcm0gKGFjdGlvbiBpcyB1bmRlZmluZWQpIG9yIFN3YWwuY2xpY2tDb25maXJtKCkgKGFjdGlvbiBpcyBcInRoaXJkXCIpXG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBhY3Rpb24gPSBcImNvbmZpcm1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFjdGlvbiA9IFwiY2FuY2VsXCI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWN0aW9uO1xuICAgIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgc21hbGwsIGJpZywgLi4uU3dhbCB9O1xuY29uc29sZS5sb2coJ3NyYy9NeUFsZXJ0L2luZGV4LnRzIEVPRicpO1xuY29uc29sZS5ncm91cEVuZCgpO1xuXG4iXX0=