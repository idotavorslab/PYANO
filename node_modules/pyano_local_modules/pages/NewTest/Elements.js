// **pages/NewTest/Elements.js
const $ = require('jquery');
let { EStore } = require("pyano_local_modules/ext_libs");
let { strong, bool } = require("pyano_local_modules/util");
const StoreFns = () => require("./StoreFns");

let currentSubject = EStore.currentTest().current_subject;

/**$readyBtn, $saveBtn [, $loadConfigBtn]*/
function $btns({ includeLoadBtn }) {
	if (includeLoadBtn)
		return $readyBtn.add($saveBtn).add($saveAsBtn).add($loadConfigBtn);
	else
		return $readyBtn.add($saveBtn).add($saveAsBtn);
}

const $currentSubjectSubtitle = $('<div id="page_subtitle_current_subject">')
	.html(bool(currentSubject)
	      ? `Current subject: ${strong(currentSubject)}`
	      : 'Current subject: --');
const $currentTruthFileSubtitle = $('<div>Truth File:</div>')
	.append(
		strong(EStore.truthFileName({ withExtension: false }))
	)
	.click(() => StoreFns().loadNewTruthFile())
	.css('cursor', 'pointer');

let $subtitle = $('<div class="subtitle" id="page_subtitle">')
	.append($currentSubjectSubtitle)
	.append($currentTruthFileSubtitle);

let $readyBtn = $('<button id="page_ready_btn">')
	.html('Ready')
	.click(() => {
		StoreFns().saveToCurrentTest();
		require("pyano_local_modules/pages/pages").toPage('inside_test', false);
	});

let $saveBtn = $('<button id="page_save_btn">')
	.html("Save")
	.click(() => StoreFns().saveToCurrentTest());

let $saveAsBtn = $('<button id="page_save_as_btn">')
	.html("Save As...")
	.click(() => {
		StoreFns().saveToCurrentTest();
		StoreFns().saveTestAs();
	});

let $loadConfigBtn = $('<button id="page_load_config_btn">')
	.html("Load Config...")
	.addClass('my-btn active-btn')
	.click(() => StoreFns().loadNewTestConfig());

$btns({ includeLoadBtn: false })
	.addClass('my-btn inactive-btn');

module.exports = {
	$readyBtn,
	$saveBtn,
	$saveAsBtn,
	$loadConfigBtn,
	$subtitle,
	$currentTruthFileSubtitle,
	$currentSubjectSubtitle,
	$btns
};
