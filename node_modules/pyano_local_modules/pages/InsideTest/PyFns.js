// **pages/InsideTest/PyFns.js
let { Python, EStore } = require("pyano_local_modules/ext_libs");
const log = s => [`PyFns.%c${s}`, 'color:#698651'];

/**@return {Promise<{ passed: Boolean, mistakes: String[] }>}*/
function checkDoneTrial() {
	console.log(...log('checkDoneTrial()'));
	return new Promise((resolve, reject) => {

		const full_truth_file_path = EStore.truthFilePath('txt');
		const trial_file_path = EStore.trialFilePath('txt');
		const { learning_type, allowed_tempo_deviation_factor } = EStore.currentTest();
		const num_of_notes_to_test = EStore.numOfNotesCurrLevel();
		Python.run('InsideTest/check_done_trial.py', {
				args: [JSON.stringify({
					learning_type,
					allowed_tempo_deviation_factor,
					trial_file_path,
					full_truth_file_path,
					num_of_notes_to_test
				})],
				mode: "json"
			},
			async (err, output) => {
				if (err) {
					reject(err);
				}
				let { passed, mistakes } = output[0];
				console.log(...log('\tcheckDoneTrial resolving'), { passed, mistakes });
				resolve({ passed, mistakes });

			});


	});
}


/** @param {string} txtFilePath
 @return {Promise<TMessage[]>} */
async function normalizeTxtFile(txtFilePath) {
	console.log(...log('normalizeTxtFile()'), { txtFilePath });
	return await Python.runAsync('InsideTest/normalize_txt_file.py', { args: [txtFilePath], mode: "json" });

}


module.exports = {
	normalizeTxtFile,
	checkDoneTrial,
};
